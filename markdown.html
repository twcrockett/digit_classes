<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Taylor Crockett (7113095045)">

<title>Homework 2: Digit Classification Models</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="markdown_files/libs/clipboard/clipboard.min.js"></script>
<script src="markdown_files/libs/quarto-html/quarto.js"></script>
<script src="markdown_files/libs/quarto-html/popper.min.js"></script>
<script src="markdown_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="markdown_files/libs/quarto-html/anchor.min.js"></script>
<link href="markdown_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="markdown_files/libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="markdown_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="markdown_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="markdown_files/libs/bootstrap/bootstrap-38714866d1cf9a29e0eaebe5917ce5bb.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="markdown_files/libs/core-js-2.5.3/shim.min.js"></script>

<script src="markdown_files/libs/react-17.0.0/react.min.js"></script>

<script src="markdown_files/libs/react-17.0.0/react-dom.min.js"></script>

<script src="markdown_files/libs/reactwidget-1.0.0/react-tools.js"></script>

<script src="markdown_files/libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>

<link href="markdown_files/libs/reactable-0.4.4/reactable.css" rel="stylesheet">

<script src="markdown_files/libs/reactable-binding-0.4.4/reactable.js"></script>


  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#the-model-i-seek" id="toc-the-model-i-seek" class="nav-link active" data-scroll-target="#the-model-i-seek">The Model I Seek</a></li>
  <li><a href="#cross-validation-to-optimize-models" id="toc-cross-validation-to-optimize-models" class="nav-link" data-scroll-target="#cross-validation-to-optimize-models">Cross-Validation to Optimize Models</a>
  <ul class="collapse">
  <li><a href="#what-is-k-fold-cross-validation" id="toc-what-is-k-fold-cross-validation" class="nav-link" data-scroll-target="#what-is-k-fold-cross-validation">What is <span class="math inline">\(k\)</span>-fold cross-validation?</a>
  <ul class="collapse">
  <li><a href="#parameter-grid-searching" id="toc-parameter-grid-searching" class="nav-link" data-scroll-target="#parameter-grid-searching">Parameter grid searching</a></li>
  <li><a href="#what-is-stratified-k-fold-cross-validation" id="toc-what-is-stratified-k-fold-cross-validation" class="nav-link" data-scroll-target="#what-is-stratified-k-fold-cross-validation">What is “stratified” <span class="math inline">\(k\)</span>-fold cross-validation?</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#baseline-linear-model" id="toc-baseline-linear-model" class="nav-link" data-scroll-target="#baseline-linear-model">Baseline Linear Model</a>
  <ul class="collapse">
  <li><a href="#linear-regression" id="toc-linear-regression" class="nav-link" data-scroll-target="#linear-regression">Linear Regression</a>
  <ul class="collapse">
  <li><a href="#theory" id="toc-theory" class="nav-link" data-scroll-target="#theory">Theory</a></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results">Results</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#dimension-reduction-models" id="toc-dimension-reduction-models" class="nav-link" data-scroll-target="#dimension-reduction-models">Dimension Reduction Models</a>
  <ul class="collapse">
  <li><a href="#singular-value-decomposition-svd" id="toc-singular-value-decomposition-svd" class="nav-link" data-scroll-target="#singular-value-decomposition-svd">Singular Value Decomposition (SVD)</a>
  <ul class="collapse">
  <li><a href="#theory-1" id="toc-theory-1" class="nav-link" data-scroll-target="#theory-1">Theory</a></li>
  <li><a href="#results-1" id="toc-results-1" class="nav-link" data-scroll-target="#results-1">Results</a></li>
  </ul></li>
  <li><a href="#higher-order-svd-hosvd" id="toc-higher-order-svd-hosvd" class="nav-link" data-scroll-target="#higher-order-svd-hosvd">Higher-Order SVD (HOSVD)</a>
  <ul class="collapse">
  <li><a href="#theory-2" id="toc-theory-2" class="nav-link" data-scroll-target="#theory-2">Theory</a></li>
  <li><a href="#results-2" id="toc-results-2" class="nav-link" data-scroll-target="#results-2">Results</a></li>
  </ul></li>
  <li><a href="#linear-discriminant-analysis-lda" id="toc-linear-discriminant-analysis-lda" class="nav-link" data-scroll-target="#linear-discriminant-analysis-lda">Linear Discriminant Analysis (LDA)</a>
  <ul class="collapse">
  <li><a href="#theory-3" id="toc-theory-3" class="nav-link" data-scroll-target="#theory-3">Theory</a></li>
  <li><a href="#results-3" id="toc-results-3" class="nav-link" data-scroll-target="#results-3">Results</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#distance-based-methods" id="toc-distance-based-methods" class="nav-link" data-scroll-target="#distance-based-methods">Distance-Based Methods</a>
  <ul class="collapse">
  <li><a href="#k-nearest-neighbors-knn" id="toc-k-nearest-neighbors-knn" class="nav-link" data-scroll-target="#k-nearest-neighbors-knn">K-Nearest Neighbors (KNN)</a>
  <ul class="collapse">
  <li><a href="#theory-4" id="toc-theory-4" class="nav-link" data-scroll-target="#theory-4">Theory</a></li>
  <li><a href="#results-4" id="toc-results-4" class="nav-link" data-scroll-target="#results-4">Results</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#decision-tree-based-methods" id="toc-decision-tree-based-methods" class="nav-link" data-scroll-target="#decision-tree-based-methods">Decision Tree-Based Methods</a>
  <ul class="collapse">
  <li><a href="#random-foresting" id="toc-random-foresting" class="nav-link" data-scroll-target="#random-foresting">Random Foresting</a>
  <ul class="collapse">
  <li><a href="#theory-5" id="toc-theory-5" class="nav-link" data-scroll-target="#theory-5">Theory</a></li>
  <li><a href="#implementation" id="toc-implementation" class="nav-link" data-scroll-target="#implementation">Implementation</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#probabilistic-models" id="toc-probabilistic-models" class="nav-link" data-scroll-target="#probabilistic-models">Probabilistic Models</a>
  <ul class="collapse">
  <li><a href="#naive-bayes" id="toc-naive-bayes" class="nav-link" data-scroll-target="#naive-bayes">Naive Bayes</a>
  <ul class="collapse">
  <li><a href="#theory-6" id="toc-theory-6" class="nav-link" data-scroll-target="#theory-6">Theory</a></li>
  <li><a href="#implementation-1" id="toc-implementation-1" class="nav-link" data-scroll-target="#implementation-1">Implementation</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#kernel-based-methods" id="toc-kernel-based-methods" class="nav-link" data-scroll-target="#kernel-based-methods">Kernel-based Methods</a>
  <ul class="collapse">
  <li><a href="#support-vector-machine-svm" id="toc-support-vector-machine-svm" class="nav-link" data-scroll-target="#support-vector-machine-svm">Support Vector Machine (SVM)</a>
  <ul class="collapse">
  <li><a href="#theory-7" id="toc-theory-7" class="nav-link" data-scroll-target="#theory-7">Theory</a></li>
  <li><a href="#results-5" id="toc-results-5" class="nav-link" data-scroll-target="#results-5">Results</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#cross-validation-to-select-best-model" id="toc-cross-validation-to-select-best-model" class="nav-link" data-scroll-target="#cross-validation-to-select-best-model">Cross-Validation to Select Best Model</a>
  <ul class="collapse">
  <li><a href="#what-is-greedy-k-fold-cross-validation" id="toc-what-is-greedy-k-fold-cross-validation" class="nav-link" data-scroll-target="#what-is-greedy-k-fold-cross-validation">What is “greedy” <span class="math inline">\(k\)</span>-fold cross-validation?</a></li>
  <li><a href="#final-results" id="toc-final-results" class="nav-link" data-scroll-target="#final-results">Final results</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Homework 2: Digit Classification Models</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Taylor Crockett (7113095045) </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="the-model-i-seek" class="level1">
<h1>The Model I Seek</h1>
<p>I’m tackling the provided Kaggle digit data which is a tensor of size <code>{python} X_shape</code>. As I write this today, I am using a 2-year old Dell laptop with persistent device failure issues and a hardware-failed integrated graphics card. This beast in its heyday could run a nasty CNN, but now it whimpers booting up Minecraft. Perhaps I abused it, or perhaps Dell is a scam of a corporation with designed obsolescence that kicks in right as the year warranty expires as its proprietary bloatware locks and there is no way to run system checks as to why my NVIDIA suddenly disappeared. Who’s to say.</p>
<p>Either way, I am on a limited computational budget here, so my goal is to find a model that hits a very high F-1 without taking all night to finish on my CPU. Therefore, I’ve designed a selection criteria that rewards performance over F-1 of 90 or greater as a logistic but punishes slow models as an exponential:</p>
<p><span class="math display">\[\text{Score} = \frac{1}{1+e^{(27-30f_{1})}}-\frac{e^{27}}{1+e^{27}}+e^{-\frac{t}{t_{m}}}\]</span></p>
<p>where <span class="math inline">\(t\)</span> is in seconds, <span class="math inline">\(t_{m}\)</span> is half an hour, and a perfect model of <span class="math inline">\(f_1=1\)</span> and <span class="math inline">\(t=0\)</span> is <span class="math inline">\(\text{Score}=1\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_selection_score(df):</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    t_m <span class="op">=</span> <span class="dv">60</span> <span class="op">*</span> <span class="dv">30</span>  <span class="co"># 30 minutes as seconds</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'selection_score'</span>] <span class="op">=</span> df.<span class="bu">apply</span>(</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">lambda</span> row: (<span class="dv">1</span> <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> np.exp(<span class="dv">27</span> <span class="op">-</span> <span class="dv">30</span> <span class="op">*</span> row[<span class="st">'f1_score'</span>]))) <span class="op">-</span> </span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>                   (np.exp(<span class="dv">27</span>) <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> np.exp(<span class="dv">27</span>))) <span class="op">+</span> </span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>                   np.exp(<span class="op">-</span>row[<span class="st">'total_time'</span>] <span class="op">/</span> t_m),</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>        axis<span class="op">=</span><span class="dv">1</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="cross-validation-to-optimize-models" class="level1 page-columns page-full">
<h1>Cross-Validation to Optimize Models</h1>
<section id="what-is-k-fold-cross-validation" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="what-is-k-fold-cross-validation">What is <span class="math inline">\(k\)</span>-fold cross-validation?</h2>
<p>Cross-validation (CV), and specifically <span class="math inline">\(k\)</span>-fold cross-validation <span class="citation" data-cites="mosteller:1968">(<a href="#ref-mosteller:1968" role="doc-biblioref">Mosteller and Tukey 1968</a>)</span>, is a resampling method used to evaluate models. The data sample is split into <span class="math inline">\(k\)</span> groups in order to internally verify consistent results for higher reliability. Therefore I</p>
<div class="no-row-height column-margin column-container"><div id="ref-mosteller:1968" class="csl-entry" role="listitem">
Mosteller, F., and J. W. Tukey. 1968. <span>“Data Analysis, Including Statistics.”</span> Edited by G. Lindzey and E. Aronson. <em>Handbook of Social Psychology</em> 2.
</div></div><p>The general procedure for <span class="math inline">\(k\)</span>-fold cross-validation is as follows:</p>
<ol type="1">
<li>Shuffle the dataset randomly</li>
<li>Split the dataset into <span class="math inline">\(k\)</span> equal-sized folds</li>
<li>For each unique fold:
<ol type="a">
<li>Take the fold as a test set</li>
<li>Take the remaining folds as a training set</li>
<li>Fit a model on the training set</li>
</ol></li>
<li>Evaluate it on the test set</li>
<li>Summarize the skill of the model using the sample of model evaluation scores</li>
</ol>
<section id="parameter-grid-searching" class="level3">
<h3 class="anchored" data-anchor-id="parameter-grid-searching">Parameter grid searching</h3>
<p>The best version of a model depends on its hyperparameters. Grid search is a systematic approach to hyperparameter tuning that works by:</p>
<ol type="1">
<li>Defining a grid of possible values for each hyperparameter</li>
<li>Creating all possible combinations of these values</li>
<li>Training and evaluating the model for each combination using cross-validation</li>
<li>Selecting the combination that yields the best performance</li>
</ol>
</section>
<section id="what-is-stratified-k-fold-cross-validation" class="level3">
<h3 class="anchored" data-anchor-id="what-is-stratified-k-fold-cross-validation">What is “stratified” <span class="math inline">\(k\)</span>-fold cross-validation?</h3>
<p>Stratified <span class="math inline">\(k\)</span>-fold cross-validation (SKF) algorithmically maintains the same class distribution as the original dataset between groups. This helps ensure that our model evaluation is more reliable and less affected by sampling variability. For the sake of optimizing each model, I first will use SKF at <span class="math inline">\(k=5\)</span> to find ideal hyperparameters and ensure that the best version of each model is represented.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>skf <span class="op">=</span> StratifiedKFold(n_splits<span class="op">=</span><span class="dv">5</span>, shuffle<span class="op">=</span><span class="va">True</span>, random_state<span class="op">=</span><span class="dv">48</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
<section id="baseline-linear-model" class="level1">
<h1>Baseline Linear Model</h1>
<section id="linear-regression" class="level2">
<h2 class="anchored" data-anchor-id="linear-regression">Linear Regression</h2>
<section id="theory" class="level3">
<h3 class="anchored" data-anchor-id="theory">Theory</h3>
<p>While linear regression is typically used for regression tasks, I adapt it here for classification using logistic regression with a one-vs-rest strategy for multi-class classification. This serves as our baseline model because it’s fast, interpretable and is the minimum ‘hurdle’ required to pass the ‘viable model’ race.</p>
<p>Logistic regression uses the logistic function to model the probability of a sample belonging to a particular class. This model uses a linear combination of features and weights, passed through the logistic function to produce class probabilities:</p>
<p><span class="math display">\[P(y=1|x) = \frac{1}{1 + e^{-(w^T x + b)}}\]</span></p>
<p>The parameter <span class="math inline">\(C\)</span> is the inverse regularization strength, When <span class="math inline">\(C\)</span> is large (i.e., <span class="math inline">\(C=100\)</span>), regularization is weak and the model is potentially overfit. When <span class="math inline">\(C\)</span> is small (i.e., <span class="math inline">\(C=0.01\)</span>), regularization is strong and the model is potentially underfit.</p>
</section>
<section id="results" class="level3">
<h3 class="anchored" data-anchor-id="results">Results</h3>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 5 Columns: 7
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
dbl (7): C, mean_accuracy, mean_precision, mean_recall, f1_score, total_time...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="cell-output-display">
<div class="reactable html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-3b0224b4fae5c7e3f978" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-3b0224b4fae5c7e3f978">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"C":[0.01,0.1,1,10,100],"mean_accuracy":[0.936652495560684,0.942029938630435,0.934931197834424,0.922563234945369,0.915250192322153],"mean_precision":[0.936841352437106,0.942148818409238,0.93496704485328,0.922859772875953,0.915810878486382],"mean_recall":[0.936652495560684,0.942029938630435,0.934931197834424,0.922563234945369,0.915250192322153],"f1_score":[0.93674691448007,0.942089374769555,0.934949121000248,0.922711480085569,0.915530449560879],"total_time":[1.50763535499573,2.63192558288574,5.13646483421326,12.4101314544678,31.2936408519745],"selection_score":[0.749873689938696,0.778026211105158,0.737632162595506,0.657167883231295,0.597180975877423]},"columns":[{"id":"C","name":"C","type":"numeric","minWidth":40,"style":{"fontWeight":"bold","background":"#f8f9fa"},"headerStyle":{"fontWeight":"bold","background":"#e9ecef"}},{"id":"mean_accuracy","name":"Accuracy","type":"numeric","format":{"cell":{"digits":4},"aggregated":{"digits":4}},"minWidth":80},{"id":"mean_precision","name":"Precision","type":"numeric","format":{"cell":{"digits":4},"aggregated":{"digits":4}},"minWidth":80},{"id":"mean_recall","name":"Recall","type":"numeric","format":{"cell":{"digits":4},"aggregated":{"digits":4}},"minWidth":80},{"id":"f1_score","name":"F1 Score","type":"numeric","format":{"cell":{"digits":4},"aggregated":{"digits":4}},"minWidth":80},{"id":"total_time","name":"Time","type":"numeric","format":{"cell":{"suffix":"s","digits":2},"aggregated":{"suffix":"s","digits":2}},"minWidth":80},{"id":"selection_score","name":"Score","type":"numeric","format":{"cell":{"digits":4},"aggregated":{"digits":4}},"minWidth":80}],"highlight":true,"bordered":true,"striped":true,"rowStyle":[null,{"background":"rgba(76, 175, 80, 0.2)"},null,null,null],"theme":{"borderColor":"#ddd","highlightColor":"rgba(0, 0, 0, 0.05)"},"dataKey":"c32e14de17b41cb539110c762dba2d29"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
</section>
</section>
<section id="dimension-reduction-models" class="level1 page-columns page-full">
<h1>Dimension Reduction Models</h1>
<section id="singular-value-decomposition-svd" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="singular-value-decomposition-svd">Singular Value Decomposition (SVD)</h2>
<section id="theory-1" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="theory-1">Theory</h3>
<p>Singular Value Decomposition (SVD) decomposes a matrix into three matrices:</p>
<p><span class="math display">\[\mathrm{X} = \mathrm{U} \Sigma \mathrm{V}^\mathrm{T}\]</span></p>
<p>where:</p>
<ul>
<li><span class="math inline">\(\mathrm{U}\)</span> is an orthogonal matrix containing the left singular vectors</li>
<li><span class="math inline">\(\Sigma\)</span> is a diagonal matrix of singular values</li>
<li><span class="math inline">\(\mathrm{V}^\mathrm{T}\)</span> is the transpose of an orthogonal matrix containing the right singular vectors</li>
</ul>
<p>SVD reduces dimensions by keeping only the top <span class="math inline">\(k\)</span> singular values and vectors. This creates a low-rank approximation of the original data. In the context of image recognition, SVD can capture the most important patterns in the image data while reducing noise.</p>
<p>I use two further methods to classify based on the SVD:</p>
<ul>
<li>a <em>residual</em> approach, where I create separate SVD subspaces for each digit class and classify by finding the digit with the minimum Frobenius norm of the difference between the original sample and its projection.</li>
<li>a <em>support vector classification</em> (SVC) approach per <span class="citation" data-cites="platt:1999">Platt (<a href="#ref-platt:1999" role="doc-biblioref">1999</a>)</span> where SVD simply reduces dimensions before training support vectors (to be explained later).</li>
</ul>
<div class="no-row-height column-margin column-container"><div id="ref-platt:1999" class="csl-entry" role="listitem">
Platt, J. C. 1999. <span>“Probabilistic Outputs for Support Vector Machines and Comparisons to Regularized Likelihood Methods.”</span> <em>Advances in Large Margin Classifiers</em> 10: 61–74. <a href="https://doi.org/10.1.1.41.1639">https://doi.org/10.1.1.41.1639</a>.
</div></div></section>
<section id="results-1" class="level3">
<h3 class="anchored" data-anchor-id="results-1">Results</h3>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 20 Columns: 8
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (1): classifier
dbl (7): n_components, mean_accuracy, mean_precision, mean_recall, f1_score,...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="cell-output-display">
<div class="reactable html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-f6f57da5e09c46334587" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-f6f57da5e09c46334587">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"classifier":["SVC","SVC","SVC","SVC","SVC","SVC","SVC","SVC","SVC","SVC","residual","residual","residual","residual","residual","residual","residual","residual","residual","residual"],"n_components":[8,16,24,32,40,48,56,64,96,128,8,16,24,32,40,48,56,64,96,128],"mean_accuracy":[0.880188446788943,0.95203231012164,0.963110008271299,0.968917963756674,0.970961379398104,0.971176433161545,0.971284191408261,0.970638856594192,0.969240602243084,0.969025317114647,0.917616651338736,0.94052398387386,0.944611335727961,0.944611451410459,0.940846853725266,0.935576764013488,0.932887840034242,0.928585781464193,0.914819448541533,0.875778051559689],"mean_precision":[0.881137544424769,0.952366001793168,0.963388511387553,0.969186450656511,0.971256086528546,0.971467840711784,0.971598285398989,0.971017332359758,0.969711803360018,0.969518757288526,0.919205145108459,0.941255211635034,0.945085204555126,0.945231293066347,0.942061455831523,0.937418293983986,0.934771175381208,0.930941180846565,0.918847964041505,0.892709901096131],"mean_recall":[0.880188446788943,0.95203231012164,0.963110008271299,0.968917963756674,0.970961379398104,0.971176433161545,0.971284191408261,0.970638856594192,0.969240602243084,0.969025317114647,0.917616651338736,0.94052398387386,0.944611335727961,0.944611451410459,0.940846853725266,0.935576764013488,0.932887840034242,0.928585781464193,0.914819448541533,0.875778051559689],"f1_score":[0.880662739894306,0.952199126722414,0.963249239698607,0.969052188609758,0.97110871060427,0.97132211508028,0.971441213014793,0.970828057589933,0.96947614554628,0.969271974401053,0.918410211354446,0.940889455683039,0.944848210726801,0.94492127058876,0.941453763028496,0.936496623702,0.933828558136095,0.929761989403347,0.91682928102415,0.884162921908429],"total_time":[3.80812764167786,2.94939565658569,3.11787080764771,3.42961835861206,3.68627691268921,4.04100251197815,4.30654120445251,4.51206827163696,5.6105637550354,6.3763415813446,1.02486896514893,1.1778552532196,7.81903481483459,7.98560237884521,4.85087370872498,5.46639037132263,5.47914171218872,5.8057541847229,7.59048581123352,9.2651059627533],"selection_score":[0.356792097502185,0.825571672717843,0.867875075769576,0.886205108594173,0.892048382820969,0.892456424344627,0.892645386520621,0.89079075511143,0.886254165403037,0.885226032803393,0.63410130435934,0.772583462040124,0.78904967326678,0.789316601809287,0.773500962284747,0.74627078109092,0.730930206115435,0.706259734935238,0.619397036002446,0.378272880087767]},"columns":[{"id":"classifier","name":"Classifier","type":"character","na":"Classifier","minWidth":80,"style":{"fontWeight":"bold","background":"#f8f9fa"},"headerStyle":{"fontWeight":"bold","background":"#e9ecef"}},{"id":"n_components","name":"k","type":"numeric","na":"k","minWidth":40,"style":{"fontWeight":"bold","background":"#f8f9fa"},"headerStyle":{"fontWeight":"bold","background":"#e9ecef"}},{"id":"mean_accuracy","name":"Accuracy","type":"numeric","format":{"cell":{"digits":4},"aggregated":{"digits":4}},"minWidth":80},{"id":"mean_precision","name":"Precision","type":"numeric","format":{"cell":{"digits":4},"aggregated":{"digits":4}},"minWidth":80},{"id":"mean_recall","name":"Recall","type":"numeric","format":{"cell":{"digits":4},"aggregated":{"digits":4}},"minWidth":80},{"id":"f1_score","name":"F1 Score","type":"numeric","format":{"cell":{"digits":4},"aggregated":{"digits":4}},"minWidth":80},{"id":"total_time","name":"Time","type":"numeric","format":{"cell":{"suffix":"s","digits":2},"aggregated":{"suffix":"s","digits":2}},"minWidth":80},{"id":"selection_score","name":"Score","type":"numeric","format":{"cell":{"digits":4},"aggregated":{"digits":4}},"minWidth":80}],"highlight":true,"bordered":true,"striped":true,"rowStyle":[null,null,null,null,null,null,{"background":"rgba(76, 175, 80, 0.2)"},null,null,null,null,null,null,null,null,null,null,null,null,null],"theme":{"borderColor":"#ddd","highlightColor":"rgba(0, 0, 0, 0.05)"},"dataKey":"20d60773d37d5e55e767d08505e53e05"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
</section>
<section id="higher-order-svd-hosvd" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="higher-order-svd-hosvd">Higher-Order SVD (HOSVD)</h2>
<section id="theory-2" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="theory-2">Theory</h3>
<p>Higher-Order SVD (HOSVD) extends the concept of SVD to tensors (multi-dimensional arrays) across modes. For a 3-D tensor <span class="math inline">\(\mathcal{X} \in \mathbb{R}^{I_1 \times I_2 \times I_3}\)</span>, HOSVD decomposes it as:</p>
<p><span class="math display">\[\mathcal{X} \approx \mathcal{G} \times_1 U^{(1)} \times_2 U^{(2)} \times_3 U^{(3)}\]</span></p>
<p>where: - <span class="math inline">\(\mathcal{G} \in \mathbb{R}^{R_1 \times R_2 \times R_3}\)</span> is the core tensor - <span class="math inline">\(U^{(i)} \in \mathbb{R}^{I_i \times R_i}\)</span> are the factor matrices - <span class="math inline">\(\times_n\)</span> denotes the n-mode product</p>
<p>In image recognition, HOSVD will capture spatial correlations in the data more effectively than standard SVD. I apply the same classifier logic from SVD to HOSVD where there is:</p>
<ul>
<li>a <em>residual</em>-based approach computing reconstruction error from subspace projections using Tucker methods previously outlined by <span class="citation" data-cites="kolda:2009">Kolda and Bader (<a href="#ref-kolda:2009" role="doc-biblioref">2009</a>)</span>.</li>
<li>an <em>SVC</em> approach using HOSVD as a dimension reduction technique before training a support vector model.</li>
</ul>
<div class="no-row-height column-margin column-container"><div id="ref-kolda:2009" class="csl-entry" role="listitem">
Kolda, Tamara G., and Brett W. Bader. 2009. <span>“Tensor Decompositions and Applications.”</span> <em>SIAM Review</em> 51 (3): 455–500. <a href="https://doi.org/10.1137/07070111X">https://doi.org/10.1137/07070111X</a>.
</div></div></section>
<section id="results-2" class="level3">
<h3 class="anchored" data-anchor-id="results-2">Results</h3>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 2 Columns: 9
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (1): classifier
dbl (8): n_components_mode1, n_components_mode2, mean_accuracy, mean_precisi...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="cell-output-display">
<div class="reactable html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-6c95e7a60848692a4402" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-6c95e7a60848692a4402">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"classifier":["SVC","residual"],"n_components_mode1":[12,12],"n_components_mode2":[12,12],"mean_accuracy":[0.969240370878088,0.159817048129703],"mean_precision":[0.969785937115696,0.14846217627387],"mean_recall":[0.969240370878088,0.159817048129703],"f1_score":[0.969513077246381,0.153930494777296],"total_time":[53.4006304740906,12.2731175422668],"selection_score":[0.860243990405664,-0.00679520590430671]},"columns":[{"id":"classifier","name":"Classifier","type":"character","na":"Classifier","minWidth":80,"style":{"fontWeight":"bold","background":"#f8f9fa"},"headerStyle":{"fontWeight":"bold","background":"#e9ecef"}},{"id":"n_components_mode1","name":"r1","type":"numeric","na":"r1","minWidth":50,"style":{"fontWeight":"bold","background":"#f8f9fa"},"headerStyle":{"fontWeight":"bold","background":"#e9ecef"}},{"id":"n_components_mode2","name":"r2","type":"numeric","na":"r2","minWidth":50,"style":{"fontWeight":"bold","background":"#f8f9fa"},"headerStyle":{"fontWeight":"bold","background":"#e9ecef"}},{"id":"mean_accuracy","name":"Accuracy","type":"numeric","format":{"cell":{"digits":4},"aggregated":{"digits":4}},"minWidth":80},{"id":"mean_precision","name":"Precision","type":"numeric","format":{"cell":{"digits":4},"aggregated":{"digits":4}},"minWidth":80},{"id":"mean_recall","name":"Recall","type":"numeric","format":{"cell":{"digits":4},"aggregated":{"digits":4}},"minWidth":80},{"id":"f1_score","name":"F1 Score","type":"numeric","format":{"cell":{"digits":4},"aggregated":{"digits":4}},"minWidth":80},{"id":"total_time","name":"Time","type":"numeric","format":{"cell":{"suffix":"s","digits":2},"aggregated":{"suffix":"s","digits":2}},"minWidth":80},{"id":"selection_score","name":"Score","type":"numeric","format":{"cell":{"digits":4},"aggregated":{"digits":4}},"minWidth":80}],"highlight":true,"bordered":true,"striped":true,"rowStyle":[{"background":"rgba(76, 175, 80, 0.2)"},null],"theme":{"borderColor":"#ddd","highlightColor":"rgba(0, 0, 0, 0.05)"},"dataKey":"fd39446defd5111a479ca852e3286d83"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
</section>
<section id="linear-discriminant-analysis-lda" class="level2">
<h2 class="anchored" data-anchor-id="linear-discriminant-analysis-lda">Linear Discriminant Analysis (LDA)</h2>
<section id="theory-3" class="level3">
<h3 class="anchored" data-anchor-id="theory-3">Theory</h3>
<p>Linear discriminant analysis (LDA) is a dimensionality reduction technique that also serves as a classifier. While principal component analysis maximizes variance without considering class labels, LDA is a supervised method that finds a linear combination of features that characterizes or separates two or more classes.</p>
<p>The key objectives of LDA are:</p>
<ol type="1">
<li>Maximize the distance between means of different classes</li>
<li>Minimize the variation within each class</li>
</ol>
<p>Mathematically, LDA seeks to find a projection that maximizes the ratio of between-class scatter to within-class scatter:</p>
<p><span class="math inline">\(J(w) = \frac{w^T S_B w}{w^T S_W w}\)</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(S_B\)</span> is the between-class scatter matrix</li>
<li><span class="math inline">\(S_W\)</span> is the within-class scatter matrix</li>
<li><span class="math inline">\(w\)</span> is the projection vector</li>
</ul>
</section>
<section id="results-3" class="level3">
<h3 class="anchored" data-anchor-id="results-3">Results</h3>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 11 Columns: 8
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (1): solver
dbl (6): mean_accuracy, mean_precision, mean_recall, f1_score, total_time, s...
lgl (1): shrinkage

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="cell-output-display">
<div class="reactable html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-1588b237be890538c708" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-1588b237be890538c708">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"solver":["svd","lsqr","eigen","lsqr","eigen","lsqr","eigen","lsqr","eigen","lsqr","eigen"],"shrinkage":[null,null,null,null,null,null,null,null,null,null,null],"mean_accuracy":[0.917079421818876,0.917079421818876,0.917079421818876,0.916003632430432,0.916003632430432,0.917294244217321,0.917294244217321,0.908690011394726,0.908690011394726,0.874919398219646,0.874919398219646],"mean_precision":[0.918889405992255,0.918889405992255,0.918889405992255,0.917681989116496,0.917681989116496,0.919067612551531,0.919067612551531,0.910761440602746,0.910761440602746,0.879626435046085,0.879626435046085],"mean_recall":[0.917079421818876,0.917079421818876,0.917079421818876,0.916003632430432,0.916003632430432,0.917294244217321,0.917294244217321,0.908690011394726,0.908690011394726,0.874919398219646,0.874919398219646],"f1_score":[0.917983521721924,0.917983521721924,0.917983521721924,0.91684204268074,0.91684204268074,0.918180072116573,0.918180072116573,0.909724546846921,0.909724546846921,0.877266602692453,0.877266602692453],"total_time":[1.06856441497803,0.753669261932373,0.870746374130249,0.857038974761963,1.07131290435791,0.641497850418091,0.762884855270386,0.665634870529175,0.788151979446411,0.65052318572998,0.834908485412598],"selection_score":[0.631103941499029,0.631278794722032,0.631213781224347,0.62321893325095,0.62309995592655,0.632711877191044,0.632644466268669,0.57205145169893,0.57198341411955,0.335453305056974,0.335350911037856]},"columns":[{"id":"solver","name":"Solver","type":"character","na":"Solver","style":{"fontWeight":"bold","background":"#f8f9fa"},"headerStyle":{"fontWeight":"bold","background":"#e9ecef"}},{"id":"shrinkage","name":"Shrinkage","type":"logical","na":"Shrinkage","style":{"fontWeight":"bold","background":"#f8f9fa"},"headerStyle":{"fontWeight":"bold","background":"#e9ecef"}},{"id":"mean_accuracy","name":"Accuracy","type":"numeric","format":{"cell":{"digits":4},"aggregated":{"digits":4}},"minWidth":80},{"id":"mean_precision","name":"Precision","type":"numeric","format":{"cell":{"digits":4},"aggregated":{"digits":4}},"minWidth":80},{"id":"mean_recall","name":"Recall","type":"numeric","format":{"cell":{"digits":4},"aggregated":{"digits":4}},"minWidth":80},{"id":"f1_score","name":"F1 Score","type":"numeric","format":{"cell":{"digits":4},"aggregated":{"digits":4}},"minWidth":80},{"id":"total_time","name":"Time","type":"numeric","format":{"cell":{"suffix":"s","digits":2},"aggregated":{"suffix":"s","digits":2}},"minWidth":80},{"id":"selection_score","name":"Score","type":"numeric","format":{"cell":{"digits":4},"aggregated":{"digits":4}},"minWidth":80}],"highlight":true,"bordered":true,"striped":true,"rowStyle":[null,null,null,null,null,{"background":"rgba(76, 175, 80, 0.2)"},null,null,null,null,null],"theme":{"borderColor":"#ddd","highlightColor":"rgba(0, 0, 0, 0.05)"},"dataKey":"19d714c90498c5564b4e1b0ad0ae2ba7"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
</section>
</section>
<section id="distance-based-methods" class="level1">
<h1>Distance-Based Methods</h1>
<section id="k-nearest-neighbors-knn" class="level2">
<h2 class="anchored" data-anchor-id="k-nearest-neighbors-knn">K-Nearest Neighbors (KNN)</h2>
<section id="theory-4" class="level3">
<h3 class="anchored" data-anchor-id="theory-4">Theory</h3>
<p>K-nearest neighbors (KNN) is a non-parametric learning algorithm. Rather than building an explicit model, KNN classifies a new instance by finding the <span class="math inline">\(k\)</span> nearest training examples in the feature space and assigning the most common class among these neighbors. For digit classification, KNN considers the pixel values as a high-dimensional feature vector and calculates distances between test samples and all training samples. The main parameters I’ll tune are:</p>
<ul>
<li>number of neighbors <span class="math inline">\(k\)</span></li>
<li>a chosen distance metric (Manhattan or Euclidean)</li>
<li>weighting scheme for neighbors (uniform or distance-based)</li>
</ul>
</section>
<section id="results-4" class="level3">
<h3 class="anchored" data-anchor-id="results-4">Results</h3>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 20 Columns: 9
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (1): weights
dbl (8): n_neighbors, p, mean_accuracy, mean_precision, mean_recall, f1_scor...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="cell-output-display">
<div class="reactable html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-28229bfdb0e371b1df1c" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-28229bfdb0e371b1df1c">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"n_neighbors":[3,3,3,3,5,5,5,5,7,7,7,7,9,9,9,9,11,11,11,11],"weights":["uniform","distance","uniform","distance","uniform","distance","uniform","distance","uniform","distance","uniform","distance","uniform","distance","uniform","distance","uniform","distance","uniform","distance"],"p":[1,1,2,2,1,1,2,2,1,1,2,2,1,1,2,2,1,1,2,2],"mean_accuracy":[0.953322459178538,0.955043294174808,0.953215279344312,0.95547392227293,0.951064336821161,0.95332292190853,0.951494270824296,0.953107405415098,0.948268175166438,0.951709729476479,0.947299681294718,0.949558382064586,0.946654577845645,0.949665793263808,0.94504161677859,0.947730540757836,0.943536066910757,0.945687125116405,0.942890558572941,0.945364023900004],"mean_precision":[0.953808853659415,0.955475552086263,0.953599932503893,0.955858848585544,0.951779541355417,0.953928346135733,0.95193099291149,0.953457498150599,0.949139502083717,0.952452229265609,0.94782935472103,0.950048750812747,0.947740820077122,0.950556424817489,0.945723098631852,0.948248291804999,0.944775250856746,0.946795916150904,0.943655611291012,0.946129048753854],"mean_recall":[0.953322459178538,0.955043294174808,0.953215279344312,0.95547392227293,0.951064336821161,0.95332292190853,0.951494270824296,0.953107405415098,0.948268175166438,0.951709729476479,0.947299681294718,0.949558382064586,0.946654577845645,0.949665793263808,0.94504161677859,0.947730540757836,0.943536066910757,0.945687125116405,0.942890558572941,0.945364023900004],"f1_score":[0.953565594393989,0.955259374231017,0.953407567126936,0.95566634666878,0.951421804679594,0.953625537931359,0.951712581767113,0.953282419639982,0.94870363855985,0.952080834607639,0.947564443988128,0.949803503146235,0.947197387536908,0.950110900321754,0.945382234893135,0.947989345588079,0.944155252283198,0.946241195817651,0.943272929805727,0.945746381617658],"total_time":[2.26077795028687,2.06400871276855,0.705819845199585,0.672635316848755,1.94441056251526,2.09452271461487,0.653872013092041,0.686317443847656,2.91222333908081,2.02043080329895,0.715479373931885,0.950283050537109,2.67775583267212,2.13919258117676,0.725184679031372,0.601126194000244,2.58777594566345,2.47395491600037,0.697233915328979,0.739388465881348],"selection_score":[0.831734784729989,0.838793919950574,0.831937365659944,0.841200924756863,0.822770583085526,0.832077063445677,0.824749393557351,0.831423585348996,0.81008566505525,0.825579222997911,0.806025632135203,0.816165829778362,0.80321172362276,0.816882429286434,0.795595228575801,0.808071246420346,0.788518940483139,0.798777124282825,0.785142573473048,0.797355566277097]},"columns":[{"id":"n_neighbors","name":"k","type":"numeric","na":"k","minWidth":50,"style":{"fontWeight":"bold","background":"#f8f9fa"},"headerStyle":{"fontWeight":"bold","background":"#e9ecef"}},{"id":"weights","name":"Weights","type":"character","na":"Weights","style":{"fontWeight":"bold","background":"#f8f9fa"},"headerStyle":{"fontWeight":"bold","background":"#e9ecef"}},{"id":"p","name":"Distance","type":"numeric","na":"Distance","style":{"fontWeight":"bold","background":"#f8f9fa"},"headerStyle":{"fontWeight":"bold","background":"#e9ecef"}},{"id":"mean_accuracy","name":"Accuracy","type":"numeric","format":{"cell":{"digits":4},"aggregated":{"digits":4}},"minWidth":80},{"id":"mean_precision","name":"Precision","type":"numeric","format":{"cell":{"digits":4},"aggregated":{"digits":4}},"minWidth":80},{"id":"mean_recall","name":"Recall","type":"numeric","format":{"cell":{"digits":4},"aggregated":{"digits":4}},"minWidth":80},{"id":"f1_score","name":"F1 Score","type":"numeric","format":{"cell":{"digits":4},"aggregated":{"digits":4}},"minWidth":80},{"id":"total_time","name":"Time","type":"numeric","format":{"cell":{"suffix":"s","digits":2},"aggregated":{"suffix":"s","digits":2}},"minWidth":80},{"id":"selection_score","name":"Score","type":"numeric","format":{"cell":{"digits":4},"aggregated":{"digits":4}},"minWidth":80}],"highlight":true,"bordered":true,"striped":true,"rowStyle":[null,null,null,{"background":"rgba(76, 175, 80, 0.2)"},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],"theme":{"borderColor":"#ddd","highlightColor":"rgba(0, 0, 0, 0.05)"},"dataKey":"bcd8e7d7926f593674b4c3784078dc10"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
</section>
</section>
<section id="decision-tree-based-methods" class="level1 page-columns page-full">
<h1>Decision Tree-Based Methods</h1>
<section id="random-foresting" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="random-foresting">Random Foresting</h2>
<section id="theory-5" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="theory-5">Theory</h3>
<p>Decision trees often run into overfitting issues by going too far down a certain decision path when a better one might exist. Random foresting <span class="citation" data-cites="breiman:2001">(<a href="#ref-breiman:2001" role="doc-biblioref">Breiman 2001</a>)</span> constructs multiple decision trees during training and combats overfitting by:</p>
<div class="no-row-height column-margin column-container"><div id="ref-breiman:2001" class="csl-entry" role="listitem">
Breiman, L. 2001. <span>“Random Forests.”</span> <em>Machine Learning</em> 45: 5–32. <a href="https://doi.org/10.1023/A:1010933404324">https://doi.org/10.1023/A:1010933404324</a>.
</div></div><ol type="1">
<li>training each tree on a random subset of the data (bootstrap aggregating or “bagging”).</li>
<li>using a random subset of features when splitting nodes.</li>
</ol>
<p>In the context of a flattened tensor, each decision tree determines which pixel positions are most discriminative for classification. When classifying, each tree in the forest makes its own prediction based on the pixel values it considers important, and the final prediction is determined by majority vote. I will tune the random forest model through:</p>
<ul>
<li><span class="math inline">\(n_e\)</span> number of trees in the forest that improves predictions but adds computational weight at diminishing return.</li>
<li>max depth of decision tree growth.</li>
<li>minimum number of samples required to split an internal node where higher values create more conservative trees that will be less distracted by noise.</li>
</ul>
</section>
<section id="implementation" class="level3">
<h3 class="anchored" data-anchor-id="implementation">Implementation</h3>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 36 Columns: 9
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
dbl (9): n_estimators, max_depth, min_samples_split, mean_accuracy, mean_pre...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="cell-output-display">
<div class="reactable html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-8b2c5b66c1e074f67309" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-8b2c5b66c1e074f67309">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"n_estimators":[50,100,200,50,100,200,50,100,200,50,100,200,50,100,200,50,100,200,50,100,200,50,100,200,50,100,200,50,100,200,50,100,200,50,100,200],"max_depth":["NA","NA","NA","NA","NA","NA","NA","NA","NA",10,10,10,10,10,10,10,10,10,20,20,20,20,20,20,20,20,20,30,30,30,30,30,30,30,30,30],"min_samples_split":[2,2,2,5,5,5,10,10,10,2,2,2,5,5,5,10,10,10,2,2,2,5,5,5,10,10,10,2,2,2,5,5,5,10,10,10],"mean_accuracy":[0.960206493258602,0.964508841034896,0.96483124815631,0.960744532555947,0.963970917420049,0.965369113929908,0.957302168468422,0.961281646393309,0.962572489545194,0.95687258151278,0.960099024218131,0.962357320099256,0.954506180337446,0.958378594110604,0.95988397045469,0.954183657533534,0.956334715739182,0.957302341992168,0.960314135822821,0.964078617825516,0.964831305997559,0.960099313424376,0.964401024946931,0.964723952639585,0.956764418377322,0.960958892224401,0.962357435781754,0.960206493258602,0.964508841034896,0.96483124815631,0.960744532555947,0.963970917420049,0.965369113929908,0.957302168468422,0.961281646393309,0.962572489545194],"mean_precision":[0.960576193559549,0.964876011771957,0.965200362626559,0.961146735980288,0.964354583696899,0.965823080459602,0.957781979229474,0.961647603914546,0.963044242889362,0.957243158138306,0.960491221077971,0.962717113300982,0.954933539340519,0.958764281716786,0.960277522081892,0.95457987473221,0.95679667447992,0.957670434714765,0.960598676341085,0.964453464992468,0.965173225935632,0.960520974706482,0.964786787154565,0.965190127167268,0.957224506060685,0.961343872698276,0.962803138570781,0.960576193559549,0.964876011771957,0.965200362626559,0.961146735980288,0.964354583696899,0.965823080459602,0.957781979229474,0.961647603914546,0.963044242889362],"mean_recall":[0.960206493258602,0.964508841034896,0.96483124815631,0.960744532555947,0.963970917420049,0.965369113929908,0.957302168468422,0.961281646393309,0.962572489545194,0.95687258151278,0.960099024218131,0.962357320099256,0.954506180337446,0.958378594110604,0.95988397045469,0.954183657533534,0.956334715739182,0.957302341992168,0.960314135822821,0.964078617825516,0.964831305997559,0.960099313424376,0.964401024946931,0.964723952639585,0.956764418377322,0.960958892224401,0.962357435781754,0.960206493258602,0.964508841034896,0.96483124815631,0.960744532555947,0.963970917420049,0.965369113929908,0.957302168468422,0.961281646393309,0.962572489545194],"f1_score":[0.960391307830269,0.964692391466294,0.965015770095253,0.960945592182596,0.964162712390693,0.96559604383766,0.957542013742355,0.961464590330777,0.962808308430281,0.957057833953356,0.960295082603492,0.962537183077744,0.954719812014556,0.9585713991177,0.960080705937599,0.954381725009897,0.956565639335578,0.957486352976397,0.960456385007778,0.964266004979627,0.965002235679297,0.960310097778758,0.964593867482061,0.964956983600741,0.956994406920701,0.961151343911229,0.962580235582915,0.960391307830269,0.964692391466294,0.965015770095253,0.960945592182596,0.964162712390693,0.96559604383766,0.957542013742355,0.961464590330777,0.962808308430281],"total_time":[2.3949511051178,3.85642337799072,8.59062504768372,2.7227509021759,4.5997097492218,8.02310085296631,2.4721040725708,4.24268937110901,8.53980493545532,2.35213780403137,4.31902527809143,7.36568236351013,1.97164058685303,4.34076189994812,7.24498152732849,2.83390808105469,3.55770039558411,7.71895813941956,2.63980865478516,8.96206426620483,27.9476981163025,7.21280026435852,13.770263671875,26.6932668685913,7.21702742576599,11.6836225986481,7.40108323097229,2.34541654586792,4.14003729820251,8.69454407691956,2.52533555030823,4.3272397518158,8.15316486358643,2.48306751251221,4.17832398414612,8.30664110183716],"selection_score":[0.858242301553208,0.872296739145869,0.870737020844553,0.860055670487236,0.87012964985958,0.872936004107629,0.847561012237695,0.861059474210757,0.863365342954931,0.845755298912486,0.856826546580846,0.863080621669555,0.836657009379682,0.850442722135866,0.854426507700707,0.834795262297133,0.843163929509249,0.844440060334071,0.858341954413246,0.868059134083644,0.860047370683195,0.85527851285462,0.866491056081787,0.860585682779293,0.842813086998892,0.855831838888561,0.86320974151041,0.858269784540216,0.872139525454021,0.870679564586417,0.860165185914559,0.870280647186575,0.8728640702792,0.84755492981556,0.861095149211489,0.863494273664187]},"columns":[{"id":"n_estimators","name":"Trees","type":"numeric","na":"Trees","style":{"fontWeight":"bold","background":"#f8f9fa"},"headerStyle":{"fontWeight":"bold","background":"#e9ecef"}},{"id":"max_depth","name":"Max. depth","type":"numeric","na":"Max. depth","style":{"fontWeight":"bold","background":"#f8f9fa"},"headerStyle":{"fontWeight":"bold","background":"#e9ecef"}},{"id":"min_samples_split","name":"Min. split","type":"numeric","na":"Min. split","style":{"fontWeight":"bold","background":"#f8f9fa"},"headerStyle":{"fontWeight":"bold","background":"#e9ecef"}},{"id":"mean_accuracy","name":"Accuracy","type":"numeric","format":{"cell":{"digits":4},"aggregated":{"digits":4}},"minWidth":80},{"id":"mean_precision","name":"Precision","type":"numeric","format":{"cell":{"digits":4},"aggregated":{"digits":4}},"minWidth":80},{"id":"mean_recall","name":"Recall","type":"numeric","format":{"cell":{"digits":4},"aggregated":{"digits":4}},"minWidth":80},{"id":"f1_score","name":"F1 Score","type":"numeric","format":{"cell":{"digits":4},"aggregated":{"digits":4}},"minWidth":80},{"id":"total_time","name":"Time","type":"numeric","format":{"cell":{"suffix":"s","digits":2},"aggregated":{"suffix":"s","digits":2}},"minWidth":80},{"id":"selection_score","name":"Score","type":"numeric","format":{"cell":{"digits":4},"aggregated":{"digits":4}},"minWidth":80}],"highlight":true,"bordered":true,"striped":true,"rowStyle":[null,null,null,null,null,{"background":"rgba(76, 175, 80, 0.2)"},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],"theme":{"borderColor":"#ddd","highlightColor":"rgba(0, 0, 0, 0.05)"},"dataKey":"0fdc8edf55f833f391459811e3eeb0a7"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<!-- ## Gradient Boosting -->
<!-- Gradient boosting is another tree-based method, but unlike random -->
<!-- foresting, which trains trees independently, gradient boosting trains -->
<!-- trees sequentially where each tree corrects the errors made by the -->
<!-- previous ones in a "gradient descent" using a loss function. I will tune -->
<!-- it through: -->
<!-- -   $n_e$ number of trees, like random forests. -->
<!-- -   learning rate, which changes how much each additional tree adds to -->
<!--     the model. -->
<!-- -   maximum depth, like random forests. -->
<!-- ```{python gb} -->
<!-- #| warning: false -->
<!-- #| output: false -->
<!-- #| echo: false -->
<!-- def gradient_boosting(X_train, X_test, y_train, y_test, n_estimators, learning_rate, max_depth): -->
<!--     # Scale data -->
<!--     scaler = StandardScaler() -->
<!--     X_train_scaled = scaler.fit_transform(X_train) -->
<!--     X_test_scaled = scaler.transform(X_test) -->
<!--     # Train Gradient Boosting classifier -->
<!--     clf = GradientBoostingClassifier( -->
<!--         n_estimators=n_estimators, -->
<!--         learning_rate=learning_rate, -->
<!--         max_depth=max_depth, -->
<!--         random_state=48 -->
<!--     ) -->
<!--     clf.fit(X_train_scaled, y_train) -->
<!--     # Predict -->
<!--     y_pred = clf.predict(X_test_scaled) -->
<!--     return y_pred -->
<!-- gb_results = [] -->
<!-- for params in ParameterGrid(param_grids["GB"]): -->
<!--     # Track metrics across folds -->
<!--     fold_accuracies = [] -->
<!--     fold_precisions = [] -->
<!--     fold_recalls = [] -->
<!--     fold_times = [] -->
<!--     print(f"Testing GB model with n_estimators={params['n_estimators']}, learning_rate={params['learning_rate']}, max_depth={params['max_depth']}") -->
<!--     # Perform k-fold cross-validation -->
<!--     for fold_idx, (train_idx, test_idx) in enumerate(skf.split(X, y)): -->
<!--         X_train, X_test = X[train_idx], X[test_idx] -->
<!--         y_train, y_test = y[train_idx], y[test_idx] -->
<!--         start_time = time.time() -->
<!--         y_pred = gradient_boosting( -->
<!--             X_train, X_test, y_train, y_test,  -->
<!--             params['n_estimators'], params['learning_rate'], params['max_depth'] -->
<!--         ) -->
<!--         elapsed_time = time.time() - start_time -->
<!--         fold_times.append(elapsed_time) -->
<!--         accuracy = accuracy_score(y_test, y_pred) -->
<!--         report = classification_report(y_test, y_pred, output_dict=True) -->
<!--         precision = report['weighted avg']['precision'] -->
<!--         recall = report['weighted avg']['recall'] -->
<!--         # Store results for this fold -->
<!--         fold_accuracies.append(accuracy) -->
<!--         fold_precisions.append(precision) -->
<!--         fold_recalls.append(recall) -->
<!--         print(f"  Fold {fold_idx+1}/{skf.n_splits}: Accuracy={accuracy:.4f}, Precision={precision:.4f}, Recall={recall:.4f}, Time={elapsed_time:.2f}s") -->
<!--     # Compute average metrics across all folds -->
<!--     mean_accuracy = np.mean(fold_accuracies) -->
<!--     mean_precision = np.mean(fold_precisions) -->
<!--     mean_recall = np.mean(fold_recalls) -->
<!--     total_time = sum(fold_times) -->
<!--     f1_score = 2 * (mean_precision * mean_recall) / (mean_precision + mean_recall) -->
<!--     # Store results for this parameter combination -->
<!--     result = { -->
<!--         'n_estimators': params['n_estimators'], -->
<!--         'learning_rate': params['learning_rate'], -->
<!--         'max_depth': params['max_depth'], -->
<!--         'mean_accuracy': mean_accuracy, -->
<!--         'mean_precision': mean_precision, -->
<!--         'mean_recall': mean_recall, -->
<!--         'f1_score': f1_score, -->
<!--         'total_time': total_time -->
<!--     } -->
<!--     gb_results.append(result) -->
<!--     print(f"  Average: Accuracy={mean_accuracy:.4f}, Precision={mean_precision:.4f}, Recall={mean_recall:.4f}, F1={f1_score:.4f}, Time={total_time:.2f}s") -->
<!-- gb_df = calculate_selection_score(pd.DataFrame(pd.DataFrame(gb_results))) -->
<!-- ``` -->
<!-- ```{r gb_results} -->
<!-- #| warning: false -->
<!-- #| output: true -->
<!-- #| echo: false -->
<!-- gb_results <- py$gb_df -->
<!-- results_table( -->
<!--   gb_results, -->
<!--   prefix_cols=list( -->
<!--     n_estimators = colDef(name = "Trees", minWidth = 80), -->
<!--     max_depth = colDef(name = "Max. depth"), -->
<!--     learning_rate = colDef(name = "Learning rate") -->
<!--   ) -->
<!-- ) -->
<!-- ``` -->
</section>
</section>
</section>
<section id="probabilistic-models" class="level1">
<h1>Probabilistic Models</h1>
<section id="naive-bayes" class="level2">
<h2 class="anchored" data-anchor-id="naive-bayes">Naive Bayes</h2>
<section id="theory-6" class="level3">
<h3 class="anchored" data-anchor-id="theory-6">Theory</h3>
<p>Naive Bayes classifiers are a family of simple probabilistic classifiers based on applying Bayes’ theorem with strong (naive) independence assumptions between the features. I’m a social scientist so I had to do one. Despite their simplicity, they often perform surprisingly well in many real-world situations, especially in text classification and other high-dimensional problems.</p>
<p>The key idea behind Naive Bayes is to use the joint probabilities of features and labels to estimate the probability of a label given the features:</p>
<p><span class="math inline">\(P(y|x_1, x_2, ..., x_n) \propto P(y) \prod_{i=1}^{n} P(x_i|y)\)</span></p>
<p>Where: - <span class="math inline">\(P(y|x_1, x_2, ..., x_n)\)</span> is the posterior probability of class <span class="math inline">\(y\)</span> given features <span class="math inline">\((x_1, x_2, ..., x_n)\)</span> - <span class="math inline">\(P(y)\)</span> is the prior probability of class <span class="math inline">\(y\)</span> - <span class="math inline">\(P(x_i|y)\)</span> is the likelihood of feature <span class="math inline">\(x_i\)</span> given class <span class="math inline">\(y\)</span></p>
<p>For digit classification, I’m using Gaussian naive Bayes, which assumes that features follow a normal distribution within each class.</p>
</section>
<section id="implementation-1" class="level3">
<h3 class="anchored" data-anchor-id="implementation-1">Implementation</h3>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 4 Columns: 7
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
dbl (7): var_smoothing, mean_accuracy, mean_precision, mean_recall, f1_score...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="cell-output-display">
<div class="reactable html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-35540ceca9898ba7278f" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-35540ceca9898ba7278f">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"var_smoothing":[1e-09,1e-08,1e-07,1e-06],"mean_accuracy":[0.725317866583375,0.730264797237502,0.737792951465408,0.745859144990659],"mean_precision":[0.776629903460468,0.78003310773819,0.786958495099701,0.793592641868392],"mean_recall":[0.725317866583375,0.730264797237502,0.737792951465408,0.745859144990659],"f1_score":[0.750097381464012,0.754328953757154,0.76158305288165,0.768985861574151],"total_time":[0.346125602722168,0.375212907791138,0.332530975341797,0.350193500518799],"selection_score":[0.0108264595926734,0.0122831355389782,0.0152967549686906,0.0190626872686855]},"columns":[{"id":"var_smoothing","name":"Smoothing","type":"numeric","na":"Smoothing","style":{"fontWeight":"bold","background":"#f8f9fa"},"headerStyle":{"fontWeight":"bold","background":"#e9ecef"}},{"id":"mean_accuracy","name":"Accuracy","type":"numeric","format":{"cell":{"digits":4},"aggregated":{"digits":4}},"minWidth":80},{"id":"mean_precision","name":"Precision","type":"numeric","format":{"cell":{"digits":4},"aggregated":{"digits":4}},"minWidth":80},{"id":"mean_recall","name":"Recall","type":"numeric","format":{"cell":{"digits":4},"aggregated":{"digits":4}},"minWidth":80},{"id":"f1_score","name":"F1 Score","type":"numeric","format":{"cell":{"digits":4},"aggregated":{"digits":4}},"minWidth":80},{"id":"total_time","name":"Time","type":"numeric","format":{"cell":{"suffix":"s","digits":2},"aggregated":{"suffix":"s","digits":2}},"minWidth":80},{"id":"selection_score","name":"Score","type":"numeric","format":{"cell":{"digits":4},"aggregated":{"digits":4}},"minWidth":80}],"highlight":true,"bordered":true,"striped":true,"rowStyle":[null,null,null,{"background":"rgba(76, 175, 80, 0.2)"}],"theme":{"borderColor":"#ddd","highlightColor":"rgba(0, 0, 0, 0.05)"},"dataKey":"81843e4c283ec8e4d2dc9393e3876f5d"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<!-- ## Bayesian Networks -->
<!-- ### Theory -->
<!-- Bayesian networks (BN) are probabilistic graphical models that represent a set of variables and their conditional dependencies via a directed acyclic graph (DAG). Unlike naive Bayes, which assumes all features are conditionally independent given the class (a bit naive), Bayesian networks can capture complex dependencies between features. -->
<!-- In the context of digit recognition, a Bayesian Network can model relationships between specific regions of the digit image. For example, the presence of certain pixel patterns in one region may influence the likelihood of patterns in another region. -->
<!-- For implementation, I'll use the `pgmpy` library which provides tools for working with probabilistic graphical models. -->
<!-- ### Results -->
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># #| warning: false</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co"># #| output: true</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co"># #| echo: false</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co"># bn_results &lt;- py$bn_df</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co"># results_table(</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co">#   bn_results,</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="co">#   prefix_cols=list(</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="co">#     n_components = colDef(name = "n_comp"),</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="co">#     max_iter = colDef(name = "Max. iter.")</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
<section id="kernel-based-methods" class="level1">
<h1>Kernel-based Methods</h1>
<section id="support-vector-machine-svm" class="level2">
<h2 class="anchored" data-anchor-id="support-vector-machine-svm">Support Vector Machine (SVM)</h2>
<section id="theory-7" class="level3">
<h3 class="anchored" data-anchor-id="theory-7">Theory</h3>
<p>Support vector machines (SVM) try to find an optimal hyperplane that maximizes the distance between the hyperplane and the nearest data points from each class, which are called support vectors. For non-linearly separable data, SVM uses kernel functions to implicitly map the input features to higher-dimensional spaces. Common kernel functions include: - Linear: <span class="math inline">\(K(x, y) = x^T y\)</span> - Polynomial: <span class="math inline">\(K(x, y) = (\gamma x^T y + r)^d\)</span> - Radial basis function (RBF): <span class="math inline">\(K(x, y) = \exp(-\gamma ||x - y||^2)\)</span></p>
</section>
<section id="results-5" class="level3">
<h3 class="anchored" data-anchor-id="results-5">Results</h3>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 48 Columns: 9
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (1): kernel
dbl (7): C, mean_accuracy, mean_precision, mean_recall, f1_score, total_time...
lgl (1): gamma

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="cell-output-display">
<div class="reactable html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-4734fe88e80b0bd269fd" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-4734fe88e80b0bd269fd">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"C":[0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,1,1,1,1,1,1,1,1,1,1,1,1,10,10,10,10,10,10,10,10,10,10,10,10,100,100,100,100,100,100,100,100,100,100,100,100],"kernel":["linear","rbf","poly","linear","rbf","poly","linear","rbf","poly","linear","rbf","poly","linear","rbf","poly","linear","rbf","poly","linear","rbf","poly","linear","rbf","poly","linear","rbf","poly","linear","rbf","poly","linear","rbf","poly","linear","rbf","poly","linear","rbf","poly","linear","rbf","poly","linear","rbf","poly","linear","rbf","poly"],"gamma":[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],"mean_accuracy":[0.951387148831318,0.924285168925368,0.88621139819651,0.951387148831318,0.924285168925368,0.88621139819651,0.951387148831318,0.277801801176491,0.975263148761908,0.951387148831318,0.825339210004223,0.969670594087468,0.948160185554726,0.968164928537137,0.964938601514284,0.948160185554726,0.968164928537137,0.964938601514284,0.948160185554726,0.317595944171627,0.975048094998467,0.948160185554726,0.935577111060982,0.97569325628879,0.947730078027845,0.971714125411396,0.975800667488012,0.947730078027845,0.971714125411396,0.975800667488012,0.947730078027845,0.330287181800829,0.975048094998467,0.947730078027845,0.939986754354,0.97569325628879,0.946977389855802,0.971391544766235,0.97569325628879,0.946977389855802,0.971391544766235,0.97569325628879,0.946977389855802,0.330287181800829,0.975048094998467,0.946977389855802,0.939771700590559,0.975263148761908],"mean_precision":[0.951745092230092,0.929386977896244,0.909078572713018,0.951745092230092,0.929386977896244,0.909078572713018,0.951745092230092,0.167591574383139,0.975522510231144,0.951745092230092,0.905157065966953,0.970151064033445,0.948576902744234,0.968620478643656,0.965843127177615,0.948576902744234,0.968620478643656,0.965843127177615,0.948576902744234,0.472288618815785,0.975332802089823,0.948576902744234,0.949364830221839,0.975951555240051,0.94819279608961,0.972147635253214,0.976045833234758,0.94819279608961,0.972147635253214,0.976045833234758,0.94819279608961,0.527855568757327,0.975332802089823,0.94819279608961,0.951731622786608,0.975951555240051,0.947541922801988,0.97183630861476,0.975951555240051,0.947541922801988,0.97183630861476,0.975951555240051,0.947541922801988,0.527855568757327,0.975332802089823,0.947541922801988,0.951508703362532,0.975522510231144],"mean_recall":[0.951387148831318,0.924285168925368,0.88621139819651,0.951387148831318,0.924285168925368,0.88621139819651,0.951387148831318,0.277801801176491,0.975263148761908,0.951387148831318,0.825339210004223,0.969670594087468,0.948160185554726,0.968164928537137,0.964938601514284,0.948160185554726,0.968164928537137,0.964938601514284,0.948160185554726,0.317595944171627,0.975048094998467,0.948160185554726,0.935577111060982,0.97569325628879,0.947730078027845,0.971714125411396,0.975800667488012,0.947730078027845,0.971714125411396,0.975800667488012,0.947730078027845,0.330287181800829,0.975048094998467,0.947730078027845,0.939986754354,0.97569325628879,0.946977389855802,0.971391544766235,0.97569325628879,0.946977389855802,0.971391544766235,0.97569325628879,0.946977389855802,0.330287181800829,0.975048094998467,0.946977389855802,0.939771700590559,0.975263148761908],"f1_score":[0.951566086869492,0.926829052629159,0.897499352248195,0.951566086869492,0.926829052629159,0.897499352248195,0.951566086869492,0.209061219948058,0.975392812255172,0.951566086869492,0.863407368311897,0.969910769557211,0.948368498372652,0.968392650015566,0.965390652471489,0.948368498372652,0.968392650015566,0.965390652471489,0.948368498372652,0.379794610106093,0.975190427764069,0.948368498372652,0.942420544366867,0.975822388671569,0.947961380593349,0.971930831992761,0.975923234964108,0.947961380593349,0.971930831992761,0.975923234964108,0.947961380593349,0.4063284997498,0.975190427764069,0.947961380593349,0.945822729143741,0.975822388671569,0.947259572218523,0.971613875791968,0.975822388671569,0.947259572218523,0.971613875791968,0.975822388671569,0.947259572218523,0.4063284997498,0.975190427764069,0.947259572218523,0.94560378293636,0.975392812255172],"total_time":[3.30116200447083,15.1766932010651,20.7673351764679,3.73347020149231,16.8602299690247,23.0887567996979,3.62644982337952,42.1630573272705,8.18410515785217,3.30133414268494,21.2405281066895,9.05004644393921,3.400545835495,8.68968677520752,9.38967967033386,3.17371678352356,8.45522141456604,9.41308379173279,3.36728310585022,40.8145680427551,8.24622249603271,3.24647498130798,17.5194640159607,8.79165554046631,3.31935691833496,8.37134957313538,8.25889110565186,3.30861902236938,8.75537657737732,8.53801202774048,3.35710573196411,42.0392684936523,8.07047700881958,3.16259121894836,17.3736782073975,8.26206398010254,3.36593890190125,8.29298901557922,8.25320839881897,3.2999951839447,8.18008065223694,8.45923447608948,3.2750358581543,41.7783126831055,8.32509350776672,3.33773732185364,17.7953646183014,8.66139531135559],"selection_score":[0.822645200887354,0.682619542657323,0.469782825052943,0.822405498518035,0.681692530848002,0.468508762158947,0.822464832855141,-0.0231517092635337,0.901125790195364,0.822645105430245,0.238425340448134,0.885627539290771,0.808273330172615,0.881311334274158,0.871516022881316,0.808399116394017,0.88144097392986,0.871503088325437,0.808291774759302,-0.0224194528528446,0.900571417596456,0.808358767195446,0.771504468782105,0.901885175534436,0.806432786337944,0.891767063909086,0.902435234204652,0.806438740862702,0.89155472815093,0.902280888853735,0.806411853632067,-0.0230841586954222,0.900668612450878,0.806519721721446,0.788529915733206,0.902178002614105,0.803123060772588,0.890924071709446,0.902182899863371,0.803159628398344,0.89098651220477,0.902068971057903,0.803173469388202,-0.022942519668198,0.900527801601187,0.803138699169166,0.787237583464837,0.900861866870044]},"columns":[{"id":"C","name":"C","type":"numeric","na":"C","minWidth":50,"style":{"fontWeight":"bold","background":"#f8f9fa"},"headerStyle":{"fontWeight":"bold","background":"#e9ecef"}},{"id":"kernel","name":"Kernel","type":"character","na":"Kernel","minWidth":100,"style":{"fontWeight":"bold","background":"#f8f9fa"},"headerStyle":{"fontWeight":"bold","background":"#e9ecef"}},{"id":"gamma","name":"Gamma","type":"logical","na":"Gamma","minWidth":80,"style":{"fontWeight":"bold","background":"#f8f9fa"},"headerStyle":{"fontWeight":"bold","background":"#e9ecef"}},{"id":"mean_accuracy","name":"Accuracy","type":"numeric","format":{"cell":{"digits":4},"aggregated":{"digits":4}},"minWidth":80},{"id":"mean_precision","name":"Precision","type":"numeric","format":{"cell":{"digits":4},"aggregated":{"digits":4}},"minWidth":80},{"id":"mean_recall","name":"Recall","type":"numeric","format":{"cell":{"digits":4},"aggregated":{"digits":4}},"minWidth":80},{"id":"f1_score","name":"F1 Score","type":"numeric","format":{"cell":{"digits":4},"aggregated":{"digits":4}},"minWidth":80},{"id":"total_time","name":"Time","type":"numeric","format":{"cell":{"suffix":"s","digits":2},"aggregated":{"suffix":"s","digits":2}},"minWidth":80},{"id":"selection_score","name":"Score","type":"numeric","format":{"cell":{"digits":4},"aggregated":{"digits":4}},"minWidth":80}],"highlight":true,"bordered":true,"striped":true,"rowStyle":[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,{"background":"rgba(76, 175, 80, 0.2)"},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],"theme":{"borderColor":"#ddd","highlightColor":"rgba(0, 0, 0, 0.05)"},"dataKey":"d626fc3eb8b777599de0ed799cc2c7ca"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<!-- ## Relevance Vector Machine (RVM) -->
<!-- ### Theory -->
<!-- Relevance vector machines (RVM) are a Bayesian sparse kernel method similar to SVM but providing probabilistic classification. Developed by @tipping:2001, RVM uses Bayesian inference to obtain sparse solutions for regression and classification. -->
<!-- Key advantages of RVM over SVM include: -->
<!-- 1.    It provides probabilistic predictions rather than just class labels. -->
<!-- 2.    It typically results in much sparser models (fewer relevance vectors). -->
<!-- 3.    It doesn't require a separate validation set to determine regularization parameters. -->
<!-- 4.    Kernel functions don't need to satisfy Mercer's condition. -->
</section>
</section>
</section>
<section id="cross-validation-to-select-best-model" class="level1">
<h1>Cross-Validation to Select Best Model</h1>
<section id="what-is-greedy-k-fold-cross-validation" class="level2">
<h2 class="anchored" data-anchor-id="what-is-greedy-k-fold-cross-validation">What is “greedy” <span class="math inline">\(k\)</span>-fold cross-validation?</h2>
<p>Earlier, I used a stratified CV method, which was good at finding optimal hyperparameters.</p>
<p>This time, I’m using a different approach called a “greedy” <span class="math inline">\(k\)</span>-fold cross-validation that works by:</p>
<ol type="1">
<li>starting with an empty ensemble,</li>
<li>iteratively adding the model that provides the best performance improvement,</li>
<li>stopping when no further improvement is achieved.</li>
</ol>
<p>It’s particularly good at comparing a diverse set of models and achieving the highest performance [soper:2021].</p>
</section>
<section id="final-results" class="level2">
<h2 class="anchored" data-anchor-id="final-results">Final results</h2>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 8 Columns: 7
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (1): model
dbl (6): mean_accuracy, mean_precision, mean_recall, f1_score, total_time, s...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="cell-output-display">
<div class="reactable html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-c5fbce87d89c9d489112" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-c5fbce87d89c9d489112">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"model":["SVM (C=10.0, k=poly, g=scale)","SVD-SVC (k=56.0)","Random Forest (t=200.0, d=nan)","HOSVD-SVC (r1=12, r2=12)","KNN (k=3, w=distance, d=2)","Logistic Regression (C=0.1)","LDA (solver=lsqr, shrink=0.1)","Naive Bayes (s=1e-06)"],"mean_accuracy":[0.975800667488012,0.971284191408261,0.965369113929908,0.969240370878088,0.95547392227293,0.942029938630435,0.917294244217321,0.745859144990659],"mean_precision":[0.976045833234758,0.971598285398989,0.965823080459602,0.969785937115696,0.955858848585544,0.942148818409238,0.919067612551531,0.793592641868392],"mean_recall":[0.975800667488012,0.971284191408261,0.965369113929908,0.969240370878088,0.95547392227293,0.942029938630435,0.917294244217321,0.745859144990659],"f1_score":[0.975923234964108,0.971441213014793,0.96559604383766,0.969513077246381,0.95566634666878,0.942089374769555,0.918180072116573,0.768985861574151],"total_time":[8.25889110565186,4.30654120445251,8.02310085296631,53.4006304740906,0.672635316848755,2.63192558288574,0.641497850418091,0.350193500518799],"selection_score":[0.902435234204652,0.892645386520621,0.872936004107629,0.860243990405664,0.841200924756863,0.778026211105158,0.632711877191044,0.0190626872686855]},"columns":[{"id":"model","name":"Model","type":"character","na":"Model","minWidth":140,"style":{"fontWeight":"bold","background":"#f8f9fa"},"headerStyle":{"fontWeight":"bold","background":"#e9ecef"}},{"id":"mean_accuracy","name":"Accuracy","type":"numeric","format":{"cell":{"digits":4},"aggregated":{"digits":4}},"minWidth":80},{"id":"mean_precision","name":"Precision","type":"numeric","format":{"cell":{"digits":4},"aggregated":{"digits":4}},"minWidth":80},{"id":"mean_recall","name":"Recall","type":"numeric","format":{"cell":{"digits":4},"aggregated":{"digits":4}},"minWidth":80},{"id":"f1_score","name":"F1 Score","type":"numeric","format":{"cell":{"digits":4},"aggregated":{"digits":4}},"minWidth":80},{"id":"total_time","name":"Time","type":"numeric","format":{"cell":{"suffix":"s","digits":2},"aggregated":{"suffix":"s","digits":2}},"minWidth":80},{"id":"selection_score","name":"Score","type":"numeric","format":{"cell":{"digits":4},"aggregated":{"digits":4}},"minWidth":80}],"highlight":true,"bordered":true,"striped":true,"rowStyle":[{"background":"rgba(76, 175, 80, 0.2)"},null,null,null,null,null,null,null],"theme":{"borderColor":"#ddd","highlightColor":"rgba(0, 0, 0, 0.05)"},"dataKey":"b08b09c69e9db8cf2b2c18dcd11d4317"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>

</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
});
</script>
</div> <!-- /content -->




</body></html>