<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Taylor Crockett (7113095045)">

<title>Homework 2: Digit Classification Models</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="markdown_files/libs/clipboard/clipboard.min.js"></script>
<script src="markdown_files/libs/quarto-html/quarto.js"></script>
<script src="markdown_files/libs/quarto-html/popper.min.js"></script>
<script src="markdown_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="markdown_files/libs/quarto-html/anchor.min.js"></script>
<link href="markdown_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="markdown_files/libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="markdown_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="markdown_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="markdown_files/libs/bootstrap/bootstrap-38714866d1cf9a29e0eaebe5917ce5bb.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="markdown_files/libs/core-js-2.5.3/shim.min.js"></script>

<script src="markdown_files/libs/react-17.0.0/react.min.js"></script>

<script src="markdown_files/libs/react-17.0.0/react-dom.min.js"></script>

<script src="markdown_files/libs/reactwidget-1.0.0/react-tools.js"></script>

<script src="markdown_files/libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>

<link href="markdown_files/libs/reactable-0.4.4/reactable.css" rel="stylesheet">

<script src="markdown_files/libs/reactable-binding-0.4.4/reactable.js"></script>


  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#the-model-i-seek" id="toc-the-model-i-seek" class="nav-link active" data-scroll-target="#the-model-i-seek">The Model I Seek</a></li>
  <li><a href="#cross-validation-to-optimize-models" id="toc-cross-validation-to-optimize-models" class="nav-link" data-scroll-target="#cross-validation-to-optimize-models">Cross-Validation to Optimize Models</a>
  <ul class="collapse">
  <li><a href="#what-is-k-fold-cross-validation" id="toc-what-is-k-fold-cross-validation" class="nav-link" data-scroll-target="#what-is-k-fold-cross-validation">What is <span class="math inline">\(k\)</span>-fold cross-validation?</a>
  <ul class="collapse">
  <li><a href="#parameter-grid-searching" id="toc-parameter-grid-searching" class="nav-link" data-scroll-target="#parameter-grid-searching">Parameter grid searching</a></li>
  <li><a href="#what-is-stratified-k-fold-cross-validation" id="toc-what-is-stratified-k-fold-cross-validation" class="nav-link" data-scroll-target="#what-is-stratified-k-fold-cross-validation">What is “stratified” <span class="math inline">\(k\)</span>-fold cross-validation?</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#baseline-linear-model" id="toc-baseline-linear-model" class="nav-link" data-scroll-target="#baseline-linear-model">Baseline Linear Model</a>
  <ul class="collapse">
  <li><a href="#linear-regression" id="toc-linear-regression" class="nav-link" data-scroll-target="#linear-regression">Linear Regression</a>
  <ul class="collapse">
  <li><a href="#theory" id="toc-theory" class="nav-link" data-scroll-target="#theory">Theory</a></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results">Results</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#dimension-reduction-models" id="toc-dimension-reduction-models" class="nav-link" data-scroll-target="#dimension-reduction-models">Dimension Reduction Models</a>
  <ul class="collapse">
  <li><a href="#singular-value-decomposition-svd" id="toc-singular-value-decomposition-svd" class="nav-link" data-scroll-target="#singular-value-decomposition-svd">Singular Value Decomposition (SVD)</a>
  <ul class="collapse">
  <li><a href="#theory-1" id="toc-theory-1" class="nav-link" data-scroll-target="#theory-1">Theory</a></li>
  <li><a href="#results-1" id="toc-results-1" class="nav-link" data-scroll-target="#results-1">Results</a></li>
  </ul></li>
  <li><a href="#higher-order-svd-hosvd" id="toc-higher-order-svd-hosvd" class="nav-link" data-scroll-target="#higher-order-svd-hosvd">Higher-Order SVD (HOSVD)</a>
  <ul class="collapse">
  <li><a href="#theory-2" id="toc-theory-2" class="nav-link" data-scroll-target="#theory-2">Theory</a></li>
  <li><a href="#results-2" id="toc-results-2" class="nav-link" data-scroll-target="#results-2">Results</a></li>
  </ul></li>
  <li><a href="#linear-discriminant-analysis-lda" id="toc-linear-discriminant-analysis-lda" class="nav-link" data-scroll-target="#linear-discriminant-analysis-lda">Linear Discriminant Analysis (LDA)</a>
  <ul class="collapse">
  <li><a href="#theory-3" id="toc-theory-3" class="nav-link" data-scroll-target="#theory-3">Theory</a></li>
  <li><a href="#results-3" id="toc-results-3" class="nav-link" data-scroll-target="#results-3">Results</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#decision-tree-based-methods" id="toc-decision-tree-based-methods" class="nav-link" data-scroll-target="#decision-tree-based-methods">Decision Tree-Based Methods</a>
  <ul class="collapse">
  <li><a href="#random-foresting" id="toc-random-foresting" class="nav-link" data-scroll-target="#random-foresting">Random Foresting</a>
  <ul class="collapse">
  <li><a href="#theory-4" id="toc-theory-4" class="nav-link" data-scroll-target="#theory-4">Theory</a></li>
  <li><a href="#implementation" id="toc-implementation" class="nav-link" data-scroll-target="#implementation">Implementation</a></li>
  </ul></li>
  <li><a href="#gradient-boosting" id="toc-gradient-boosting" class="nav-link" data-scroll-target="#gradient-boosting">Gradient Boosting</a></li>
  </ul></li>
  <li><a href="#cross-validation-to-select-models" id="toc-cross-validation-to-select-models" class="nav-link" data-scroll-target="#cross-validation-to-select-models">Cross-Validation to Select Models</a>
  <ul class="collapse">
  <li><a href="#what-is-greedy-k-fold-cross-validation" id="toc-what-is-greedy-k-fold-cross-validation" class="nav-link" data-scroll-target="#what-is-greedy-k-fold-cross-validation">What is “greedy” <span class="math inline">\(k\)</span>-fold cross-validation?</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Homework 2: Digit Classification Models</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Taylor Crockett (7113095045) </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="the-model-i-seek" class="level1">
<h1>The Model I Seek</h1>
<p>As I write this today, I am using a 2-year old Dell laptop with persistent device failure issues and a hardware-failed integrated graphics card. This beast in its heyday could run a nasty CNN, but now it wimpers booting up Minecraft. Perhaps I abused it but perhaps Dell is a scam of a corporation with designed obsolescence that kicks in right as the year warranty expires as its proprietary bloatware locks and there is no way to run system checks as to why my NVIDIA suddenly disappeared.</p>
<p>Either way, I am on a limited computational budget here, so my goal is to find a model that hits a very high F-1 without taking all night to finish on my CPU. Therefore, I’ve designed a selection criteria that rewards performance over F-1 of 70 or greater as a logistic but punishes slow models as an exponential:</p>
<p><span class="math display">\[\text{Score} = \frac{1}{1+e^{7-10f_{1}}}-\frac{e^{3}}{1+e^{3}}+e^{-\frac{t}{t_{m}}}\]</span></p>
<p>where <span class="math inline">\(t\)</span> is in seconds, <span class="math inline">\(t_{m}\)</span> is half an hour, and a perfect model of <span class="math inline">\(f_1=1\)</span> and <span class="math inline">\(t=0\)</span> is <span class="math inline">\(\text{Score}=1\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_selection_score(df):</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    t_m <span class="op">=</span> <span class="dv">60</span> <span class="op">*</span> <span class="dv">30</span>  <span class="co"># 30 minutes as seconds</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'selection_score'</span>] <span class="op">=</span> df.<span class="bu">apply</span>(</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">lambda</span> row: (<span class="dv">1</span> <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> np.exp(<span class="dv">7</span> <span class="op">-</span> <span class="dv">10</span> <span class="op">*</span> row[<span class="st">'f1_score'</span>]))) <span class="op">-</span> </span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>                   (np.exp(<span class="dv">3</span>) <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> np.exp(<span class="dv">3</span>))) <span class="op">+</span> </span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>                   np.exp(<span class="op">-</span>row[<span class="st">'total_time'</span>] <span class="op">/</span> t_m),</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>        axis<span class="op">=</span><span class="dv">1</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="cross-validation-to-optimize-models" class="level1 page-columns page-full">
<h1>Cross-Validation to Optimize Models</h1>
<section id="what-is-k-fold-cross-validation" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="what-is-k-fold-cross-validation">What is <span class="math inline">\(k\)</span>-fold cross-validation?</h2>
<p>Cross-validation (CV), and specifically <span class="math inline">\(k\)</span>-fold cross-validation <span class="citation" data-cites="mosteller:1968">(<a href="#ref-mosteller:1968" role="doc-biblioref">Mosteller and Tukey 1968</a>)</span>, is a resampling method used to evaluate models. The data sample is split into <span class="math inline">\(k\)</span> groups in order to internally verify consistent results for higher reliability.</p>
<div class="no-row-height column-margin column-container"><div id="ref-mosteller:1968" class="csl-entry" role="listitem">
Mosteller, F., and J. W. Tukey. 1968. <span>“Data Analysis, Including Statistics.”</span> Edited by G. Lindzey and E. Aronson. <em>Handbook of Social Psychology</em> 2.
</div></div><p>The general procedure for <span class="math inline">\(k\)</span>-fold cross-validation is as follows:</p>
<ol type="1">
<li>Shuffle the dataset randomly</li>
<li>Split the dataset into <span class="math inline">\(k\)</span> equal-sized folds</li>
<li>For each unique fold:
<ol type="a">
<li>Take the fold as a test set</li>
<li>Take the remaining folds as a training set</li>
<li>Fit a model on the training set</li>
</ol></li>
<li>Evaluate it on the test set</li>
<li>Summarize the skill of the model using the sample of model evaluation scores</li>
</ol>
<section id="parameter-grid-searching" class="level3">
<h3 class="anchored" data-anchor-id="parameter-grid-searching">Parameter grid searching</h3>
<p>The best version of a model depends on its hyperparameters. Grid search is a systematic approach to hyperparameter tuning that works by:</p>
<ol type="1">
<li>Defining a grid of possible values for each hyperparameter</li>
<li>Creating all possible combinations of these values</li>
<li>Training and evaluating the model for each combination using cross-validation</li>
<li>Selecting the combination that yields the best performance</li>
</ol>
</section>
<section id="what-is-stratified-k-fold-cross-validation" class="level3">
<h3 class="anchored" data-anchor-id="what-is-stratified-k-fold-cross-validation">What is “stratified” <span class="math inline">\(k\)</span>-fold cross-validation?</h3>
<p>Stratified <span class="math inline">\(k\)</span>-fold cross-validation (SKF) algorithmically maintains the same class distribution as the original dataset between groups. This helps ensure that our model evaluation is more reliable and less affected by sampling variability. For the sake of optimizing each model, I first will use SKF at <span class="math inline">\(k=5\)</span> to find ideal hyperparameters and ensure that the best version of each model is represented.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>skf <span class="op">=</span> StratifiedKFold(n_splits<span class="op">=</span><span class="dv">5</span>, shuffle<span class="op">=</span><span class="va">True</span>, random_state<span class="op">=</span><span class="dv">48</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
<section id="baseline-linear-model" class="level1">
<h1>Baseline Linear Model</h1>
<section id="linear-regression" class="level2">
<h2 class="anchored" data-anchor-id="linear-regression">Linear Regression</h2>
<section id="theory" class="level3">
<h3 class="anchored" data-anchor-id="theory">Theory</h3>
<p>While linear regression is typically used for regression tasks, I adapt it here for classification using logistic regression with a one-vs-rest strategy for multi-class classification. This serves as our baseline model because it’s fast, interpretable and is the minimum ‘hurdle’ required to pass the ‘viable model’ race.</p>
<p>Logistic regression uses the logistic function to model the probability of a sample belonging to a particular class. This model uses a linear combination of features and weights, passed through the logistic function to produce class probabilities:</p>
<p><span class="math display">\[P(y=1|x) = \frac{1}{1 + e^{-(w^T x + b)}}\]</span></p>
<p>The parameter <span class="math inline">\(C\)</span> is the inverse regularization strength, When <span class="math inline">\(C\)</span> is large (i.e., <span class="math inline">\(C=100\)</span>), regularization is weak and the model is potentially overfit. When <span class="math inline">\(C\)</span> is small (i.e., <span class="math inline">\(C=0.01\)</span>), regularization is strong and the model is potentially underfit.</p>
</section>
<section id="results" class="level3">
<h3 class="anchored" data-anchor-id="results">Results</h3>
<div class="cell">
<div class="cell-output-display">
<div class="reactable html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-b55a01cd6964bee9fdc9" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-b55a01cd6964bee9fdc9">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"C":[0.01,0.1],"mean_accuracy":[0.701454545454545,0.696363636363636],"mean_precision":[0.686376464264572,0.687966023775868],"mean_recall":[0.701454545454545,0.696363636363636],"f1_score":[0.693833597000901,0.692139359295267],"total_time":[2.48681902885437,3.70153522491455],"selection_score":[0.530634136505541,0.525730088551792]},"columns":[{"id":"C","name":"C","type":"numeric","minWidth":40,"style":{"fontWeight":"bold","background":"#f8f9fa"},"headerStyle":{"fontWeight":"bold","background":"#e9ecef"}},{"id":"mean_accuracy","name":"Accuracy","type":"numeric","format":{"cell":{"digits":4},"aggregated":{"digits":4}},"minWidth":80},{"id":"mean_precision","name":"Precision","type":"numeric","format":{"cell":{"digits":4},"aggregated":{"digits":4}},"minWidth":80},{"id":"mean_recall","name":"Recall","type":"numeric","format":{"cell":{"digits":4},"aggregated":{"digits":4}},"minWidth":80},{"id":"f1_score","name":"F1 Score","type":"numeric","format":{"cell":{"digits":4},"aggregated":{"digits":4}},"minWidth":80},{"id":"total_time","name":"Time","type":"numeric","format":{"cell":{"suffix":"s","digits":2},"aggregated":{"suffix":"s","digits":2}},"minWidth":80},{"id":"selection_score","name":"Score","type":"numeric","format":{"cell":{"digits":4},"aggregated":{"digits":4}},"minWidth":80}],"highlight":true,"bordered":true,"striped":true,"rowStyle":[{"background":"rgba(76, 175, 80, 0.2)"},null],"theme":{"borderColor":"#ddd","highlightColor":"rgba(0, 0, 0, 0.05)"},"dataKey":"38f93d138e54a6c569e449cd7936c36c"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
</section>
</section>
<section id="dimension-reduction-models" class="level1 page-columns page-full">
<h1>Dimension Reduction Models</h1>
<section id="singular-value-decomposition-svd" class="level2">
<h2 class="anchored" data-anchor-id="singular-value-decomposition-svd">Singular Value Decomposition (SVD)</h2>
<section id="theory-1" class="level3">
<h3 class="anchored" data-anchor-id="theory-1">Theory</h3>
<p>Singular Value Decomposition (SVD) decomposes a matrix into three matrices:</p>
<p><span class="math display">\[\mathrm{X} = \mathrm{U} \Sigma \mathrm{V}^\mathrm{T}\]</span></p>
<p>where:</p>
<ul>
<li><span class="math inline">\(\mathrm{U}\)</span> is an orthogonal matrix containing the left singular vectors</li>
<li><span class="math inline">\(\Sigma\)</span> is a diagonal matrix of singular values</li>
<li><span class="math inline">\(\mathrm{V}^\mathrm{T}\)</span> is the transpose of an orthogonal matrix containing the right singular vectors</li>
</ul>
<p>SVD reduces dimensions by keeping only the top <span class="math inline">\(k\)</span> singular values and vectors. This creates a low-rank approximation of the original data. In the context of image recognition, SVD can capture the most important patterns in the image data while reducing noise.</p>
<p>I use two further methods to classify based on the SVD:</p>
<ul>
<li>a <em>residual</em> approach, where I create separate SVD subspaces for each digit class and classify by finding the digit with the minimum Frobenius norm of the difference between the original sample and its projection.</li>
<li>a <em>support vector classification</em> (SVC) approach where SVD simply reduces dimensions before training support vectors (to be explained later).</li>
</ul>
</section>
<section id="results-1" class="level3">
<h3 class="anchored" data-anchor-id="results-1">Results</h3>
<div class="cell">
<div class="cell-output-display">
<div class="reactable html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-c91666d75999ba30a3c0" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-c91666d75999ba30a3c0">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"classifier":["residual"],"n_components":[16],"mean_accuracy":[0.694727272727273],"mean_precision":[0.689176623742244],"mean_recall":[0.694727272727273],"f1_score":[0.691940816788336],"total_time":[2.16718292236328],"selection_score":[0.526085547218629]},"columns":[{"id":"classifier","name":"Classifier","type":"character","na":"Classifier","minWidth":80,"style":{"fontWeight":"bold","background":"#f8f9fa"},"headerStyle":{"fontWeight":"bold","background":"#e9ecef"}},{"id":"n_components","name":"k","type":"numeric","na":"k","minWidth":40,"style":{"fontWeight":"bold","background":"#f8f9fa"},"headerStyle":{"fontWeight":"bold","background":"#e9ecef"}},{"id":"mean_accuracy","name":"Accuracy","type":"numeric","format":{"cell":{"digits":4},"aggregated":{"digits":4}},"minWidth":80},{"id":"mean_precision","name":"Precision","type":"numeric","format":{"cell":{"digits":4},"aggregated":{"digits":4}},"minWidth":80},{"id":"mean_recall","name":"Recall","type":"numeric","format":{"cell":{"digits":4},"aggregated":{"digits":4}},"minWidth":80},{"id":"f1_score","name":"F1 Score","type":"numeric","format":{"cell":{"digits":4},"aggregated":{"digits":4}},"minWidth":80},{"id":"total_time","name":"Time","type":"numeric","format":{"cell":{"suffix":"s","digits":2},"aggregated":{"suffix":"s","digits":2}},"minWidth":80},{"id":"selection_score","name":"Score","type":"numeric","format":{"cell":{"digits":4},"aggregated":{"digits":4}},"minWidth":80}],"highlight":true,"bordered":true,"striped":true,"rowStyle":[{"background":"rgba(76, 175, 80, 0.2)"}],"theme":{"borderColor":"#ddd","highlightColor":"rgba(0, 0, 0, 0.05)"},"dataKey":"eb03e888e74e6836ff64f41ffde18b4d"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
</section>
<section id="higher-order-svd-hosvd" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="higher-order-svd-hosvd">Higher-Order SVD (HOSVD)</h2>
<section id="theory-2" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="theory-2">Theory</h3>
<p>Higher-Order SVD (HOSVD) extends the concept of SVD to tensors (multi-dimensional arrays) across modes. For a 3-D tensor <span class="math inline">\(\mathcal{X} \in \mathbb{R}^{I_1 \times I_2 \times I_3}\)</span>, HOSVD decomposes it as:</p>
<p><span class="math display">\[\mathcal{X} \approx \mathcal{G} \times_1 U^{(1)} \times_2 U^{(2)} \times_3 U^{(3)}\]</span></p>
<p>where: - <span class="math inline">\(\mathcal{G} \in \mathbb{R}^{R_1 \times R_2 \times R_3}\)</span> is the core tensor - <span class="math inline">\(U^{(i)} \in \mathbb{R}^{I_i \times R_i}\)</span> are the factor matrices - <span class="math inline">\(\times_n\)</span> denotes the n-mode product</p>
<p>In image recognition, HOSVD will capture spatial correlations in the data more effectively than standard SVD. I apply the same classifier logic from SVD to HOSVD where there is:</p>
<ul>
<li>a <em>residual</em>-based approach computing reconstruction error from subspace projections using Tucker methods previously outlined by <span class="citation" data-cites="kolda:2009">Kolda and Bader (<a href="#ref-kolda:2009" role="doc-biblioref">2009</a>)</span>.</li>
<li>an <em>SVC</em> approach using HOSVD as a dimension reduction technique before training a support vector model.</li>
</ul>
<div class="no-row-height column-margin column-container"><div id="ref-kolda:2009" class="csl-entry" role="listitem">
Kolda, Tamara G., and Brett W. Bader. 2009. <span>“Tensor Decompositions and Applications.”</span> <em>SIAM Review</em> 51 (3): 455–500. <a href="https://doi.org/10.1137/07070111X">https://doi.org/10.1137/07070111X</a>.
</div></div></section>
<section id="results-2" class="level3">
<h3 class="anchored" data-anchor-id="results-2">Results</h3>
<div class="cell">
<div class="cell-output-display">
<div class="reactable html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-879285cc341834dbd2ad" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-879285cc341834dbd2ad">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"classifier":["residual"],"n_components_mode1":[4],"n_components_mode2":[4],"mean_accuracy":[0.376090909090909],"mean_precision":[0.375256461691411],"mean_recall":[0.376090909090909],"f1_score":[0.375673222021958],"total_time":[15.1478946208954],"selection_score":[0.076615242477981]},"columns":[{"id":"classifier","name":"Classifier","type":"character","na":"Classifier","minWidth":80,"style":{"fontWeight":"bold","background":"#f8f9fa"},"headerStyle":{"fontWeight":"bold","background":"#e9ecef"}},{"id":"n_components_mode1","name":"r1","type":"numeric","na":"r1","minWidth":50,"style":{"fontWeight":"bold","background":"#f8f9fa"},"headerStyle":{"fontWeight":"bold","background":"#e9ecef"}},{"id":"n_components_mode2","name":"r2","type":"numeric","na":"r2","minWidth":50,"style":{"fontWeight":"bold","background":"#f8f9fa"},"headerStyle":{"fontWeight":"bold","background":"#e9ecef"}},{"id":"mean_accuracy","name":"Accuracy","type":"numeric","format":{"cell":{"digits":4},"aggregated":{"digits":4}},"minWidth":80},{"id":"mean_precision","name":"Precision","type":"numeric","format":{"cell":{"digits":4},"aggregated":{"digits":4}},"minWidth":80},{"id":"mean_recall","name":"Recall","type":"numeric","format":{"cell":{"digits":4},"aggregated":{"digits":4}},"minWidth":80},{"id":"f1_score","name":"F1 Score","type":"numeric","format":{"cell":{"digits":4},"aggregated":{"digits":4}},"minWidth":80},{"id":"total_time","name":"Time","type":"numeric","format":{"cell":{"suffix":"s","digits":2},"aggregated":{"suffix":"s","digits":2}},"minWidth":80},{"id":"selection_score","name":"Score","type":"numeric","format":{"cell":{"digits":4},"aggregated":{"digits":4}},"minWidth":80}],"highlight":true,"bordered":true,"striped":true,"rowStyle":[{"background":"rgba(76, 175, 80, 0.2)"}],"theme":{"borderColor":"#ddd","highlightColor":"rgba(0, 0, 0, 0.05)"},"dataKey":"80f6139e073d41c8bbad330fbc32ca48"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
</section>
<section id="linear-discriminant-analysis-lda" class="level2">
<h2 class="anchored" data-anchor-id="linear-discriminant-analysis-lda">Linear Discriminant Analysis (LDA)</h2>
<section id="theory-3" class="level3">
<h3 class="anchored" data-anchor-id="theory-3">Theory</h3>
<p>Linear discriminant analysis (LDA) is a dimensionality reduction technique that also serves as a classifier. While principal component analysis maximizes variance without considering class labels, LDA is a supervised method that finds a linear combination of features that characterizes or separates two or more classes.</p>
<p>The key objectives of LDA are:</p>
<ol type="1">
<li>Maximize the distance between means of different classes</li>
<li>Minimize the variation within each class</li>
</ol>
<p>Mathematically, LDA seeks to find a projection that maximizes the ratio of between-class scatter to within-class scatter:</p>
<p><span class="math inline">\(J(w) = \frac{w^T S_B w}{w^T S_W w}\)</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(S_B\)</span> is the between-class scatter matrix</li>
<li><span class="math inline">\(S_W\)</span> is the within-class scatter matrix</li>
<li><span class="math inline">\(w\)</span> is the projection vector</li>
</ul>
</section>
<section id="results-3" class="level3">
<h3 class="anchored" data-anchor-id="results-3">Results</h3>
<div class="cell">
<div class="cell-output-display">
<div class="reactable html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-16bfceb453dc84f347e8" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-16bfceb453dc84f347e8">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"solver":["svd"],"shrinkage":[null],"mean_accuracy":[0.673272727272727],"mean_precision":[0.671950762774722],"mean_recall":[0.673272727272727],"f1_score":[0.672611095469897],"total_time":[1.90445947647095],"selection_score":[0.478320989997088]},"columns":[{"id":"solver","name":"Solver","type":"character","na":"Solver","style":{"fontWeight":"bold","background":"#f8f9fa"},"headerStyle":{"fontWeight":"bold","background":"#e9ecef"}},{"id":"shrinkage","name":"Shrinkage","type":"character","na":"Shrinkage","style":{"fontWeight":"bold","background":"#f8f9fa"},"headerStyle":{"fontWeight":"bold","background":"#e9ecef"}},{"id":"mean_accuracy","name":"Accuracy","type":"numeric","format":{"cell":{"digits":4},"aggregated":{"digits":4}},"minWidth":80},{"id":"mean_precision","name":"Precision","type":"numeric","format":{"cell":{"digits":4},"aggregated":{"digits":4}},"minWidth":80},{"id":"mean_recall","name":"Recall","type":"numeric","format":{"cell":{"digits":4},"aggregated":{"digits":4}},"minWidth":80},{"id":"f1_score","name":"F1 Score","type":"numeric","format":{"cell":{"digits":4},"aggregated":{"digits":4}},"minWidth":80},{"id":"total_time","name":"Time","type":"numeric","format":{"cell":{"suffix":"s","digits":2},"aggregated":{"suffix":"s","digits":2}},"minWidth":80},{"id":"selection_score","name":"Score","type":"numeric","format":{"cell":{"digits":4},"aggregated":{"digits":4}},"minWidth":80}],"highlight":true,"bordered":true,"striped":true,"rowStyle":[{"background":"rgba(76, 175, 80, 0.2)"}],"theme":{"borderColor":"#ddd","highlightColor":"rgba(0, 0, 0, 0.05)"},"dataKey":"fd5cc1ba2fa012df8be1ef79d3aa1d25"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
</section>
</section>
<section id="decision-tree-based-methods" class="level1 page-columns page-full">
<h1>Decision Tree-Based Methods</h1>
<section id="random-foresting" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="random-foresting">Random Foresting</h2>
<section id="theory-4" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="theory-4">Theory</h3>
<p>Decision trees often run into overfitting issues by going too far down a certain decision path when a better one might exist. Random foresting <span class="citation" data-cites="breiman:2001">(<a href="#ref-breiman:2001" role="doc-biblioref">Breiman 2001</a>)</span> constructs multiple decision trees during training and combats overfitting by:</p>
<div class="no-row-height column-margin column-container"><div id="ref-breiman:2001" class="csl-entry" role="listitem">
Breiman, L. 2001. <span>“Random Forests.”</span> <em>Machine Learning</em> 45: 5–32. <a href="https://doi.org/10.1023/A:1010933404324">https://doi.org/10.1023/A:1010933404324</a>.
</div></div><ol type="1">
<li>training each tree on a random subset of the data (bootstrap aggregating or “bagging”).</li>
<li>using a random subset of features when splitting nodes.</li>
</ol>
<p>In the context of a flattened tensor, each decision tree determines which pixel positions are most discriminative for classification. When classifying, each tree in the forest makes its own prediction based on the pixel values it considers important, and the final prediction is determined by majority vote. I will tune the random forest model through:</p>
<ul>
<li><span class="math inline">\(n_e\)</span> number of trees in the forest that improves predictions but adds computational weight at diminishing return.</li>
<li>max depth of decision tree growth.</li>
<li>minimum number of samples required to split an internal node where higher values create more conservative trees that will be less distracted by noise.</li>
</ul>
</section>
<section id="implementation" class="level3">
<h3 class="anchored" data-anchor-id="implementation">Implementation</h3>
<div class="cell">
<div class="cell-output-display">
<div class="reactable html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-ddf5de8f1bf8fc7fbf32" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-ddf5de8f1bf8fc7fbf32">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"n_estimators":[50],"max_depth":[null],"min_samples_split":[2],"mean_accuracy":[0.682909090909091],"mean_precision":[0.684532131437397],"mean_recall":[0.682909090909091],"f1_score":[0.683719647965278],"total_time":[3.65846800804138],"selection_score":[0.504784235342407]},"columns":[{"id":"n_estimators","name":"Trees","type":"numeric","na":"Trees","style":{"fontWeight":"bold","background":"#f8f9fa"},"headerStyle":{"fontWeight":"bold","background":"#e9ecef"}},{"id":"max_depth","name":"Max. depth","type":"character","na":"Max. depth","style":{"fontWeight":"bold","background":"#f8f9fa"},"headerStyle":{"fontWeight":"bold","background":"#e9ecef"}},{"id":"min_samples_split","name":"Min. split","type":"numeric","na":"Min. split","style":{"fontWeight":"bold","background":"#f8f9fa"},"headerStyle":{"fontWeight":"bold","background":"#e9ecef"}},{"id":"mean_accuracy","name":"Accuracy","type":"numeric","format":{"cell":{"digits":4},"aggregated":{"digits":4}},"minWidth":80},{"id":"mean_precision","name":"Precision","type":"numeric","format":{"cell":{"digits":4},"aggregated":{"digits":4}},"minWidth":80},{"id":"mean_recall","name":"Recall","type":"numeric","format":{"cell":{"digits":4},"aggregated":{"digits":4}},"minWidth":80},{"id":"f1_score","name":"F1 Score","type":"numeric","format":{"cell":{"digits":4},"aggregated":{"digits":4}},"minWidth":80},{"id":"total_time","name":"Time","type":"numeric","format":{"cell":{"suffix":"s","digits":2},"aggregated":{"suffix":"s","digits":2}},"minWidth":80},{"id":"selection_score","name":"Score","type":"numeric","format":{"cell":{"digits":4},"aggregated":{"digits":4}},"minWidth":80}],"highlight":true,"bordered":true,"striped":true,"rowStyle":[{"background":"rgba(76, 175, 80, 0.2)"}],"theme":{"borderColor":"#ddd","highlightColor":"rgba(0, 0, 0, 0.05)"},"dataKey":"1b28bb1db7e2bbf07dd44fa903603e4d"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
</section>
<section id="gradient-boosting" class="level2">
<h2 class="anchored" data-anchor-id="gradient-boosting">Gradient Boosting</h2>
<p>Gradient boosting is another tree-based method, but unlike random foresting, which trains trees independently, gradient boosting trains trees sequentially where each tree corrects the errors made by the previous ones in a “gradient descent” using a loss function. I will tune it through:</p>
<ul>
<li><span class="math inline">\(n_e\)</span> number of trees, like random forests.</li>
<li>learning rate, which changes how much each additional tree adds to the model.</li>
<li>maximum depth, like random forests.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> gradient_boosting(X_train, X_test, y_train, y_test, n_estimators, learning_rate, max_depth):</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Scale data</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    scaler <span class="op">=</span> StandardScaler()</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    X_train_scaled <span class="op">=</span> scaler.fit_transform(X_train)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    X_test_scaled <span class="op">=</span> scaler.transform(X_test)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Train Gradient Boosting classifier</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    clf <span class="op">=</span> GradientBoostingClassifier(</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>        n_estimators<span class="op">=</span>n_estimators,</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>        learning_rate<span class="op">=</span>learning_rate,</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>        max_depth<span class="op">=</span>max_depth,</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>        random_state<span class="op">=</span><span class="dv">48</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    clf.fit(X_train_scaled, y_train)</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Predict</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    y_pred <span class="op">=</span> clf.predict(X_test_scaled)</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> y_pred</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>gb_results <span class="op">=</span> []</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> params <span class="kw">in</span> ParameterGrid(param_grids[<span class="st">"GB"</span>]):</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Track metrics across folds</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>    fold_accuracies <span class="op">=</span> []</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>    fold_precisions <span class="op">=</span> []</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>    fold_recalls <span class="op">=</span> []</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>    fold_times <span class="op">=</span> []</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Testing GB model with n_estimators=</span><span class="sc">{</span>params[<span class="st">'n_estimators'</span>]<span class="sc">}</span><span class="ss">, learning_rate=</span><span class="sc">{</span>params[<span class="st">'learning_rate'</span>]<span class="sc">}</span><span class="ss">, max_depth=</span><span class="sc">{</span>params[<span class="st">'max_depth'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Perform k-fold cross-validation</span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> fold_idx, (train_idx, test_idx) <span class="kw">in</span> <span class="bu">enumerate</span>(skf.split(X, y)):</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>        X_train, X_test <span class="op">=</span> X[train_idx], X[test_idx]</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>        y_train, y_test <span class="op">=</span> y[train_idx], y[test_idx]</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>        start_time <span class="op">=</span> time.time()</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>        y_pred <span class="op">=</span> gradient_boosting(</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>            X_train, X_test, y_train, y_test, </span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>            params[<span class="st">'n_estimators'</span>], params[<span class="st">'learning_rate'</span>], params[<span class="st">'max_depth'</span>]</span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>        elapsed_time <span class="op">=</span> time.time() <span class="op">-</span> start_time</span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>        fold_times.append(elapsed_time)</span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>        accuracy <span class="op">=</span> accuracy_score(y_test, y_pred)</span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>        report <span class="op">=</span> classification_report(y_test, y_pred, output_dict<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>        precision <span class="op">=</span> report[<span class="st">'weighted avg'</span>][<span class="st">'precision'</span>]</span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>        recall <span class="op">=</span> report[<span class="st">'weighted avg'</span>][<span class="st">'recall'</span>]</span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Store results for this fold</span></span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>        fold_accuracies.append(accuracy)</span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>        fold_precisions.append(precision)</span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>        fold_recalls.append(recall)</span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  Fold </span><span class="sc">{</span>fold_idx<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>skf<span class="sc">.</span>n_splits<span class="sc">}</span><span class="ss">: Accuracy=</span><span class="sc">{</span>accuracy<span class="sc">:.4f}</span><span class="ss">, Precision=</span><span class="sc">{</span>precision<span class="sc">:.4f}</span><span class="ss">, Recall=</span><span class="sc">{</span>recall<span class="sc">:.4f}</span><span class="ss">, Time=</span><span class="sc">{</span>elapsed_time<span class="sc">:.2f}</span><span class="ss">s"</span>)</span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute average metrics across all folds</span></span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a>    mean_accuracy <span class="op">=</span> np.mean(fold_accuracies)</span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a>    mean_precision <span class="op">=</span> np.mean(fold_precisions)</span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a>    mean_recall <span class="op">=</span> np.mean(fold_recalls)</span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a>    total_time <span class="op">=</span> <span class="bu">sum</span>(fold_times)</span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a>    f1_score <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> (mean_precision <span class="op">*</span> mean_recall) <span class="op">/</span> (mean_precision <span class="op">+</span> mean_recall)</span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Store results for this parameter combination</span></span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> {</span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a>        <span class="st">'n_estimators'</span>: params[<span class="st">'n_estimators'</span>],</span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a>        <span class="st">'learning_rate'</span>: params[<span class="st">'learning_rate'</span>],</span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a>        <span class="st">'max_depth'</span>: params[<span class="st">'max_depth'</span>],</span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a>        <span class="st">'mean_accuracy'</span>: mean_accuracy,</span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a>        <span class="st">'mean_precision'</span>: mean_precision,</span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a>        <span class="st">'mean_recall'</span>: mean_recall,</span>
<span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a>        <span class="st">'f1_score'</span>: f1_score,</span>
<span id="cb3-73"><a href="#cb3-73" aria-hidden="true" tabindex="-1"></a>        <span class="st">'total_time'</span>: total_time</span>
<span id="cb3-74"><a href="#cb3-74" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-75"><a href="#cb3-75" aria-hidden="true" tabindex="-1"></a>    gb_results.append(result)</span>
<span id="cb3-76"><a href="#cb3-76" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-77"><a href="#cb3-77" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Average: Accuracy=</span><span class="sc">{</span>mean_accuracy<span class="sc">:.4f}</span><span class="ss">, Precision=</span><span class="sc">{</span>mean_precision<span class="sc">:.4f}</span><span class="ss">, Recall=</span><span class="sc">{</span>mean_recall<span class="sc">:.4f}</span><span class="ss">, F1=</span><span class="sc">{</span>f1_score<span class="sc">:.4f}</span><span class="ss">, Time=</span><span class="sc">{</span>total_time<span class="sc">:.2f}</span><span class="ss">s"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Testing GB model with n_estimators=50, learning_rate=0.01, max_depth=3
  Fold 1/5: Accuracy=0.6564, Precision=0.6328, Recall=0.6564, Time=142.69s
  Fold 2/5: Accuracy=0.6568, Precision=0.6252, Recall=0.6568, Time=147.19s
  Fold 3/5: Accuracy=0.6541, Precision=0.6322, Recall=0.6541, Time=144.67s
  Fold 4/5: Accuracy=0.6486, Precision=0.6237, Recall=0.6486, Time=145.80s
  Fold 5/5: Accuracy=0.6400, Precision=0.6230, Recall=0.6400, Time=143.93s
  Average: Accuracy=0.6512, Precision=0.6274, Recall=0.6512, F1=0.6391, Time=724.29s</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>gb_df <span class="op">=</span> calculate_selection_score(pd.DataFrame(pd.DataFrame(gb_results)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="cross-validation-to-select-models" class="level1">
<h1>Cross-Validation to Select Models</h1>
<section id="what-is-greedy-k-fold-cross-validation" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="what-is-greedy-k-fold-cross-validation">What is “greedy” <span class="math inline">\(k\)</span>-fold cross-validation?</h2>

</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
});
</script>
</div> <!-- /content -->




</body></html>